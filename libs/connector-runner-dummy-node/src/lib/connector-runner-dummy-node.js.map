{
  "version": 3,
  "sources": ["../../../../../../../libs/connector-runner-dummy-node/src/lib/connector-runner-dummy-node.ts"],
  "sourcesContent": ["import { ConnectorRuntimeSDK } from '@transai/connector-runtime-sdk';\nimport {\n  ActionInterface,\n  BaseConnectorConfig,\n  KafkaCallbackResponse,\n  XodJobType,\n} from '@xip-online-data/types';\n\nexport class ConnectorRunnerDummyNode extends ConnectorRuntimeSDK<\n  {\n    failProbability?: number;\n  } & BaseConnectorConfig\n> {\n  readonly CONNECTOR_INSTANCE: string = 'XOD_CONNECTOR_DUMMY_NODE_CONFIG';\n\n  override init = async (): Promise<void> => {\n    const { config } = this.connectorSDK;\n\n    const failProbability = config.failProbability || 0.0;\n    if (failProbability > 0) {\n      this.connectorSDK.logger.debug(\n        'Fail probability set to',\n        failProbability,\n      );\n    }\n\n    const dummyProcessFailed = (): boolean => {\n      return Math.random() < failProbability;\n    };\n\n    this.callbackFunction = async (\n      message: XodJobType,\n      action: ActionInterface,\n    ): Promise<KafkaCallbackResponse> => {\n      this.connectorSDK.logger.info(\n        'Received message: ',\n        message.testRun ? '(test run)' : '',\n        message.eventId,\n        message.payload,\n      );\n\n      if (dummyProcessFailed()) {\n        this.connectorSDK.logger.error('Dummy process failed');\n        return this.connectorSDK.receiver.responses.internalServerError(\n          'Dummy process failed',\n        )(message);\n      }\n\n      return this.connectorSDK.receiver.responses.ok()(message);\n    };\n  };\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mCAAoC;AAQ7B,MAAM,iCAAiC,iDAI5C;AAAA,EAJK;AAAA;AAKL,SAAS,qBAA6B;AAEtC,SAAS,OAAO,YAA2B;AACzC,YAAM,EAAE,OAAO,IAAI,KAAK;AAExB,YAAM,kBAAkB,OAAO,mBAAmB;AAClD,UAAI,kBAAkB,GAAG;AACvB,aAAK,aAAa,OAAO;AAAA,UACvB;AAAA,UACA;AAAA,QACF;AAAA,MACF;AAEA,YAAM,qBAAqB,MAAe;AACxC,eAAO,KAAK,OAAO,IAAI;AAAA,MACzB;AAEA,WAAK,mBAAmB,OACtB,SACA,WACmC;AACnC,aAAK,aAAa,OAAO;AAAA,UACvB;AAAA,UACA,QAAQ,UAAU,eAAe;AAAA,UACjC,QAAQ;AAAA,UACR,QAAQ;AAAA,QACV;AAEA,YAAI,mBAAmB,GAAG;AACxB,eAAK,aAAa,OAAO,MAAM,sBAAsB;AACrD,iBAAO,KAAK,aAAa,SAAS,UAAU;AAAA,YAC1C;AAAA,UACF,EAAE,OAAO;AAAA,QACX;AAEA,eAAO,KAAK,aAAa,SAAS,UAAU,GAAG,EAAE,OAAO;AAAA,MAC1D;AAAA,IACF;AAAA;AACF;",
  "names": []
}
