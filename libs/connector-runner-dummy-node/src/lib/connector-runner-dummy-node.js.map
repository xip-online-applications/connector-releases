{
  "version": 3,
  "sources": ["../../../../../../../libs/connector-runner-dummy-node/src/lib/connector-runner-dummy-node.ts"],
  "sourcesContent": ["import { ConnectorRuntime } from '@transai/connector-runtime';\nimport {\n  KafkaCallbackResponse,\n  XodBaseMessageType,\n  XodJobType,\n} from '@xip-online-data/types';\nimport { InternalServerError, Ok } from '@xip-online-data/kafka-base-service';\nimport { Logger } from '@transai/logger';\n\nexport class ConnectorRunnerDummyNode extends ConnectorRuntime<{\n  failProbability?: number;\n}> {\n  readonly CONNECTOR_INSTANCE: string = 'XOD_CONNECTOR_DUMMY_NODE_CONFIG';\n\n  override init = async (): Promise<void> => {\n    const failProbability = this.config.failProbability || 0.0;\n    if (failProbability > 0) {\n      Logger.getInstance().debug('Fail probability set to', failProbability);\n    }\n\n    const dummyProcessFailed = () => {\n      return Math.random() < failProbability;\n    };\n\n    const mainCallbackFunction = (\n      callbackFunction: (message: XodJobType) => Promise<KafkaCallbackResponse>,\n    ) => {\n      return async (message: XodJobType) => {\n        Logger.getInstance().info(\n          'Received message: ',\n          message.testRun ? '(test run)' : '',\n          message.eventId,\n          message.payload,\n        );\n\n        if (dummyProcessFailed()) {\n          Logger.getInstance().error('Dummy process failed');\n          return InternalServerError('Dummy process failed')(message);\n        }\n\n        return callbackFunction(message);\n      };\n    };\n\n    this.callbackFunction = mainCallbackFunction(this.emitEventType(Ok())) as (\n      message: XodBaseMessageType,\n    ) => Promise<KafkaCallbackResponse>;\n  };\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,+BAAiC;AAMjC,gCAAwC;AACxC,oBAAuB;AAEhB,MAAM,iCAAiC,0CAE3C;AAAA,EAFI;AAAA;AAGL,SAAS,qBAA6B;AAEtC,SAAS,OAAO,YAA2B;AACzC,YAAM,kBAAkB,KAAK,OAAO,mBAAmB;AACvD,UAAI,kBAAkB,GAAG;AACvB,6BAAO,YAAY,EAAE,MAAM,2BAA2B,eAAe;AAAA,MACvE;AAEA,YAAM,qBAAqB,MAAM;AAC/B,eAAO,KAAK,OAAO,IAAI;AAAA,MACzB;AAEA,YAAM,uBAAuB,CAC3B,qBACG;AACH,eAAO,OAAO,YAAwB;AACpC,+BAAO,YAAY,EAAE;AAAA,YACnB;AAAA,YACA,QAAQ,UAAU,eAAe;AAAA,YACjC,QAAQ;AAAA,YACR,QAAQ;AAAA,UACV;AAEA,cAAI,mBAAmB,GAAG;AACxB,iCAAO,YAAY,EAAE,MAAM,sBAAsB;AACjD,uBAAO,+CAAoB,sBAAsB,EAAE,OAAO;AAAA,UAC5D;AAEA,iBAAO,iBAAiB,OAAO;AAAA,QACjC;AAAA,MACF;AAEA,WAAK,mBAAmB,qBAAqB,KAAK,kBAAc,8BAAG,CAAC,CAAC;AAAA,IAGvE;AAAA;AACF;",
  "names": []
}
