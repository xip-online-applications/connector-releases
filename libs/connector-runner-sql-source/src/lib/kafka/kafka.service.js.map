{
  "version": 3,
  "sources": ["../../../../../../../../libs/connector-runner-sql-source/src/lib/kafka/kafka.service.ts"],
  "sourcesContent": ["import { v4 as uuidv4 } from 'uuid';\nimport { KafkaSourceInterface } from '@xip-online-data/kafka-base-service';\nimport { BaseConnectorConfig } from '@xip-online-data/types';\nimport {\n  generateCollectionName,\n  generateKafkaTopic,\n} from '../helper.functions';\nimport { SourceConfig, SqlSourceRunnerConfig } from '../types';\n\nexport class KafkaService {\n  readonly #kafkaSourceService: KafkaSourceInterface;\n\n  constructor(kafkaSourceService: KafkaSourceInterface) {\n    this.#kafkaSourceService = kafkaSourceService;\n  }\n\n  public async sendBatch(\n    record: Array<any>,\n    config: SqlSourceRunnerConfig & BaseConnectorConfig,\n    sinkConfig: SourceConfig,\n    priority = false,\n  ): Promise<boolean> {\n    const resultSize = record.length;\n    const { batchSize } = sinkConfig;\n    const endOfBatch = resultSize !== batchSize;\n\n    const parsedRecords = record.map((r) => {\n      return {\n        type: 'SOURCE' as const,\n        eventId: uuidv4(),\n        eventType: 'event.source-sink.kafka' as const,\n        created: Date.now(),\n        ttl: 3600000, // 1 month\n        tenantIdentifier: config.tenantIdentifier,\n        payload: {\n          keyField: sinkConfig.keyField,\n          incrementalField: sinkConfig.incrementalField,\n          collection: generateCollectionName(config, sinkConfig),\n          body: r,\n          priority,\n          endOfBatch,\n        },\n      };\n    });\n\n    const topic = generateKafkaTopic(config, sinkConfig);\n\n    return this.#kafkaSourceService.send(parsedRecords, topic);\n  }\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAA6B;AAG7B,oBAGO;AAGA,MAAM,aAAa;AAAA,EACf;AAAA,EAET,YAAY,oBAA0C;AACpD,SAAK,sBAAsB;AAAA,EAC7B;AAAA,EAEA,MAAa,UACX,QACA,QACA,YACA,WAAW,OACO;AAClB,UAAM,aAAa,OAAO;AAC1B,UAAM,EAAE,UAAU,IAAI;AACtB,UAAM,aAAa,eAAe;AAElC,UAAM,gBAAgB,OAAO,IAAI,CAAC,MAAM;AACtC,aAAO;AAAA,QACL,MAAM;AAAA,QACN,aAAS,YAAAA,IAAO;AAAA,QAChB,WAAW;AAAA,QACX,SAAS,KAAK,IAAI;AAAA,QAClB,KAAK;AAAA;AAAA,QACL,kBAAkB,OAAO;AAAA,QACzB,SAAS;AAAA,UACP,UAAU,WAAW;AAAA,UACrB,kBAAkB,WAAW;AAAA,UAC7B,gBAAY,sCAAuB,QAAQ,UAAU;AAAA,UACrD,MAAM;AAAA,UACN;AAAA,UACA;AAAA,QACF;AAAA,MACF;AAAA,IACF,CAAC;AAED,UAAM,YAAQ,kCAAmB,QAAQ,UAAU;AAEnD,WAAO,KAAK,oBAAoB,KAAK,eAAe,KAAK;AAAA,EAC3D;AACF;",
  "names": ["uuidv4"]
}
