{
  "version": 3,
  "sources": ["../../../../../../../libs/connector-runner-sql-source/src/lib/connector-runner-sql-source.ts"],
  "sourcesContent": ["import { ConnectorRuntime } from '@transai/connector-runtime';\nimport { isSqlSourceRunnerConfigType, SqlSourceRunnerConfig } from './types';\nimport { QueryResultHandler } from './query-result.handler';\nimport { KafkaService } from './kafka/kafka.service';\nimport { DatasourceExtractorService } from './datasource-extractor/datasource-extractor.service';\nimport { generateCollectionName } from './helper.functions';\n\nexport class ConnectorRunnerSqlSource extends ConnectorRuntime<SqlSourceRunnerConfig> {\n  readonly CONNECTOR_INSTANCE: string = 'XOD_CONNECTOR_SQL_SOURCE_CONFIG';\n\n  private readonly extractors = new Map<string, DatasourceExtractorService>();\n\n  override init = async (): Promise<void> => {\n    const kafkaWrapper = new KafkaService(this.kafkaService);\n    const queryResultHandler = new QueryResultHandler(\n      this.config,\n      kafkaWrapper,\n      this.offsetStore,\n    );\n    this.log.debug(\n      `Initializing SQL source runner, gotten ${this.config.queries.length} queries`,\n    );\n    // eslint-disable-next-line no-restricted-syntax\n    for (const queryConfig of this.config.queries) {\n      const extractor = new DatasourceExtractorService(\n        this.config,\n        queryConfig,\n        this.offsetStore,\n        queryResultHandler,\n        this.messageObservable,\n      );\n      // eslint-disable-next-line no-await-in-loop\n      await extractor.init();\n      this.extractors.set(\n        generateCollectionName(this.config, queryConfig),\n        extractor,\n      );\n    }\n  };\n\n  override exit = async () => {\n    this.extractors.forEach((service) => service.stop());\n  };\n\n  override isValidConfig = (config: SqlSourceRunnerConfig): boolean => {\n    return isSqlSourceRunnerConfigType(config);\n  };\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,+BAAiC;AACjC,mBAAmE;AACnE,0BAAmC;AACnC,mBAA6B;AAC7B,kCAA2C;AAC3C,oBAAuC;AAEhC,MAAM,iCAAiC,0CAAwC;AAAA,EAA/E;AAAA;AACL,SAAS,qBAA6B;AAEtC,SAAiB,aAAa,oBAAI,IAAwC;AAE1E,SAAS,OAAO,YAA2B;AACzC,YAAM,eAAe,IAAI,0BAAa,KAAK,YAAY;AACvD,YAAM,qBAAqB,IAAI;AAAA,QAC7B,KAAK;AAAA,QACL;AAAA,QACA,KAAK;AAAA,MACP;AACA,WAAK,IAAI;AAAA,QACP,0CAA0C,KAAK,OAAO,QAAQ,MAAM;AAAA,MACtE;AAEA,iBAAW,eAAe,KAAK,OAAO,SAAS;AAC7C,cAAM,YAAY,IAAI;AAAA,UACpB,KAAK;AAAA,UACL;AAAA,UACA,KAAK;AAAA,UACL;AAAA,UACA,KAAK;AAAA,QACP;AAEA,cAAM,UAAU,KAAK;AACrB,aAAK,WAAW;AAAA,cACd,sCAAuB,KAAK,QAAQ,WAAW;AAAA,UAC/C;AAAA,QACF;AAAA,MACF;AAAA,IACF;AAEA,SAAS,OAAO,YAAY;AAC1B,WAAK,WAAW,QAAQ,CAAC,YAAY,QAAQ,KAAK,CAAC;AAAA,IACrD;AAEA,SAAS,gBAAgB,CAAC,WAA2C;AACnE,iBAAO,0CAA4B,MAAM;AAAA,IAC3C;AAAA;AACF;",
  "names": []
}
