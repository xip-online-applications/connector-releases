{
  "version": 3,
  "sources": ["../../../../../../../libs/connector-runner-mail-source/src/lib/connector-runner-mail-source.ts"],
  "sourcesContent": ["import {\n  ConnectorRuntime,\n  PersistentOffsetStoreInterface,\n} from '@transai/connector-runtime';\nimport { MailsourceProcessorService } from './mail-processor/mailsource-processor.service';\nimport { isYamlConfigType, MailSourceProcessConfig } from './types';\nimport { MailClient, MailConfig } from '@xip-online-data/mail-client';\n\nexport class ConnectorRunnerMailSource extends ConnectorRuntime<MailSourceProcessConfig> {\n  readonly CONNECTOR_INSTANCE: string = 'XOD_CONNECTOR_MAIL_SOURCE_CONFIG';\n\n  #processors: Array<MailsourceProcessorService> = [];\n\n  override init = async (): Promise<void> => {\n    if (this.offsetStoreInstance === undefined) {\n      throw new Error(\n        'Offset store is not defined. Please provide an temp location for the offset store.',\n      );\n    }\n\n    this.#processors = await Promise.all(\n      this.config.mailboxes.map(async (mailSourceConfig) => {\n        const mailClient = new MailClient(this.config.mailConfig);\n\n        const processor = new MailsourceProcessorService(\n          this.config,\n          mailSourceConfig,\n          this.kafkaService,\n          mailClient,\n          this.offsetStoreInstance as PersistentOffsetStoreInterface,\n        );\n        await processor.init();\n\n        return processor;\n      }),\n    );\n  };\n\n  override exit = async () => {\n    this.#processors.forEach((service) => service.stop());\n  };\n\n  override isValidConfig = (config: MailSourceProcessConfig): boolean => {\n    return isYamlConfigType(config);\n  };\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,+BAGO;AACP,kCAA2C;AAC3C,mBAA0D;AAC1D,yBAAuC;AAEhC,MAAM,kCAAkC,0CAA0C;AAAA,EAAlF;AAAA;AACL,SAAS,qBAA6B;AAEtC,uBAAiD,CAAC;AAElD,SAAS,OAAO,YAA2B;AACzC,UAAI,KAAK,wBAAwB,QAAW;AAC1C,cAAM,IAAI;AAAA,UACR;AAAA,QACF;AAAA,MACF;AAEA,WAAK,cAAc,MAAM,QAAQ;AAAA,QAC/B,KAAK,OAAO,UAAU,IAAI,OAAO,qBAAqB;AACpD,gBAAM,aAAa,IAAI,8BAAW,KAAK,OAAO,UAAU;AAExD,gBAAM,YAAY,IAAI;AAAA,YACpB,KAAK;AAAA,YACL;AAAA,YACA,KAAK;AAAA,YACL;AAAA,YACA,KAAK;AAAA,UACP;AACA,gBAAM,UAAU,KAAK;AAErB,iBAAO;AAAA,QACT,CAAC;AAAA,MACH;AAAA,IACF;AAEA,SAAS,OAAO,YAAY;AAC1B,WAAK,YAAY,QAAQ,CAAC,YAAY,QAAQ,KAAK,CAAC;AAAA,IACtD;AAEA,SAAS,gBAAgB,CAAC,WAA6C;AACrE,iBAAO,+BAAiB,MAAM;AAAA,IAChC;AAAA;AAAA,EAjCA;AAkCF;",
  "names": []
}
