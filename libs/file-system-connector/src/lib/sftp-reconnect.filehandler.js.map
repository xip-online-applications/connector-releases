{
  "version": 3,
  "sources": ["../../../../../../../libs/file-system-connector/src/lib/sftp-reconnect.filehandler.ts"],
  "sourcesContent": ["import { Logger } from '@transai/logger';\nimport { ActiveFileHandlerInterface } from './file-handler.interface';\nimport { FileInfo } from './types';\nimport { SftpConfig, SftpFilehandler } from './sftp.filehandler';\n\nexport interface SftpConnectConfig extends SftpConfig {\n  type: 'sftp-reconnect';\n}\n\nexport class SftpReconnectFilehandler extends SftpFilehandler {\n  readonly #logger: Logger;\n\n  constructor(config: SftpConfig) {\n    if (config.type === 'sftp') {\n      throw new Error(\n        'SftpReconnectFilehandler requires a SftpConnectConfig with type \"sftp-reconnect\".',\n      );\n    }\n    super(config);\n    this.#logger = Logger.getInstance();\n    this.#logger.info('SFTP Reconnect File handler setup!');\n  }\n\n  override async init(): Promise<void> {\n    await super.init();\n    this.#logger.debug('SFTP Reconnect initialized! disconnecting client.');\n    await this.sftpClient.end();\n    this.#logger.debug('SFTP Reconnect initialized! Client disconnected.');\n  }\n\n  override async list(dir: string): Promise<Array<FileInfo>> {\n    this.#logger.debug(\n      `SFTP Reconnect listing directory: ${dir}. First connecting to SFTP server.`,\n    );\n    await this.sftpClient.connect(this.config);\n    this.#logger.debug('SFTP Reconnect connected to SFTP server.');\n    try {\n      return await super.list(dir);\n    } finally {\n      this.#logger.debug('SFTP Reconnect disconnecting from SFTP server.');\n      await this.sftpClient.end();\n      this.#logger.debug('SFTP Reconnect disconnected from SFTP server.');\n    }\n  }\n\n  override async readFile(\n    filepath: string,\n  ): Promise<ActiveFileHandlerInterface> {\n    this.#logger.debug(\n      `SFTP Reconnect reading file: ${filepath}. First connecting to SFTP server.`,\n    );\n    await this.sftpClient.connect(this.config);\n    this.#logger.debug('SFTP Reconnect connected to SFTP server.');\n    try {\n      return super.readFile(filepath);\n    } finally {\n      this.#logger.debug('SFTP Reconnect disconnecting from SFTP server.');\n      await this.sftpClient.end();\n      this.#logger.debug('SFTP Reconnect disconnected from SFTP server.');\n    }\n  }\n\n  override async writeFile(\n    data: ActiveFileHandlerInterface,\n    remotePath: string,\n    filename: string,\n  ): Promise<boolean> {\n    this.#logger.debug(\n      `SFTP Reconnect writing file: ${filename} to path: ${remotePath}. First connecting to SFTP server.`,\n    );\n    await this.sftpClient.connect(this.config);\n    this.#logger.debug('SFTP Reconnect connected to SFTP server.');\n    try {\n      return super.writeFile(data, remotePath, filename);\n    } finally {\n      this.#logger.debug('SFTP Reconnect disconnecting from SFTP server.');\n      await this.sftpClient.end();\n      this.#logger.debug('SFTP Reconnect disconnected from SFTP server.');\n    }\n  }\n\n  override async deleteFile(filepath: string): Promise<boolean> {\n    this.#logger.debug(\n      `SFTP Reconnect deleting file: ${filepath}. First connecting to SFTP server.`,\n    );\n    await this.sftpClient.connect(this.config);\n    this.#logger.debug('SFTP Reconnect connected to SFTP server.');\n    try {\n      return super.deleteFile(filepath);\n    } finally {\n      this.#logger.debug('SFTP Reconnect disconnecting from SFTP server.');\n      await this.sftpClient.end();\n      this.#logger.debug('SFTP Reconnect disconnected from SFTP server.');\n    }\n  }\n\n  override async fileExists(filepath: string): Promise<boolean> {\n    this.#logger.debug(\n      `SFTP Reconnect checking if file exists: ${filepath}. First connecting to SFTP server.`,\n    );\n    await this.sftpClient.connect(this.config);\n    this.#logger.debug('SFTP Reconnect connected to SFTP server.');\n    try {\n      return super.fileExists(filepath);\n    } finally {\n      this.#logger.debug('SFTP Reconnect disconnecting from SFTP server.');\n      await this.sftpClient.end();\n      this.#logger.debug('SFTP Reconnect disconnected from SFTP server.');\n    }\n  }\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBAAuB;AAGvB,kBAA4C;AAMrC,MAAM,iCAAiC,4BAAgB;AAAA,EACnD;AAAA,EAET,YAAY,QAAoB;AAC9B,QAAI,OAAO,SAAS,QAAQ;AAC1B,YAAM,IAAI;AAAA,QACR;AAAA,MACF;AAAA,IACF;AACA,UAAM,MAAM;AACZ,SAAK,UAAU,qBAAO,YAAY;AAClC,SAAK,QAAQ,KAAK,oCAAoC;AAAA,EACxD;AAAA,EAEA,MAAe,OAAsB;AACnC,UAAM,MAAM,KAAK;AACjB,SAAK,QAAQ,MAAM,mDAAmD;AACtE,UAAM,KAAK,WAAW,IAAI;AAC1B,SAAK,QAAQ,MAAM,kDAAkD;AAAA,EACvE;AAAA,EAEA,MAAe,KAAK,KAAuC;AACzD,SAAK,QAAQ;AAAA,MACX,qCAAqC,GAAG;AAAA,IAC1C;AACA,UAAM,KAAK,WAAW,QAAQ,KAAK,MAAM;AACzC,SAAK,QAAQ,MAAM,0CAA0C;AAC7D,QAAI;AACF,aAAO,MAAM,MAAM,KAAK,GAAG;AAAA,IAC7B,UAAE;AACA,WAAK,QAAQ,MAAM,gDAAgD;AACnE,YAAM,KAAK,WAAW,IAAI;AAC1B,WAAK,QAAQ,MAAM,+CAA+C;AAAA,IACpE;AAAA,EACF;AAAA,EAEA,MAAe,SACb,UACqC;AACrC,SAAK,QAAQ;AAAA,MACX,gCAAgC,QAAQ;AAAA,IAC1C;AACA,UAAM,KAAK,WAAW,QAAQ,KAAK,MAAM;AACzC,SAAK,QAAQ,MAAM,0CAA0C;AAC7D,QAAI;AACF,aAAO,MAAM,SAAS,QAAQ;AAAA,IAChC,UAAE;AACA,WAAK,QAAQ,MAAM,gDAAgD;AACnE,YAAM,KAAK,WAAW,IAAI;AAC1B,WAAK,QAAQ,MAAM,+CAA+C;AAAA,IACpE;AAAA,EACF;AAAA,EAEA,MAAe,UACb,MACA,YACA,UACkB;AAClB,SAAK,QAAQ;AAAA,MACX,gCAAgC,QAAQ,aAAa,UAAU;AAAA,IACjE;AACA,UAAM,KAAK,WAAW,QAAQ,KAAK,MAAM;AACzC,SAAK,QAAQ,MAAM,0CAA0C;AAC7D,QAAI;AACF,aAAO,MAAM,UAAU,MAAM,YAAY,QAAQ;AAAA,IACnD,UAAE;AACA,WAAK,QAAQ,MAAM,gDAAgD;AACnE,YAAM,KAAK,WAAW,IAAI;AAC1B,WAAK,QAAQ,MAAM,+CAA+C;AAAA,IACpE;AAAA,EACF;AAAA,EAEA,MAAe,WAAW,UAAoC;AAC5D,SAAK,QAAQ;AAAA,MACX,iCAAiC,QAAQ;AAAA,IAC3C;AACA,UAAM,KAAK,WAAW,QAAQ,KAAK,MAAM;AACzC,SAAK,QAAQ,MAAM,0CAA0C;AAC7D,QAAI;AACF,aAAO,MAAM,WAAW,QAAQ;AAAA,IAClC,UAAE;AACA,WAAK,QAAQ,MAAM,gDAAgD;AACnE,YAAM,KAAK,WAAW,IAAI;AAC1B,WAAK,QAAQ,MAAM,+CAA+C;AAAA,IACpE;AAAA,EACF;AAAA,EAEA,MAAe,WAAW,UAAoC;AAC5D,SAAK,QAAQ;AAAA,MACX,2CAA2C,QAAQ;AAAA,IACrD;AACA,UAAM,KAAK,WAAW,QAAQ,KAAK,MAAM;AACzC,SAAK,QAAQ,MAAM,0CAA0C;AAC7D,QAAI;AACF,aAAO,MAAM,WAAW,QAAQ;AAAA,IAClC,UAAE;AACA,WAAK,QAAQ,MAAM,gDAAgD;AACnE,YAAM,KAAK,WAAW,IAAI;AAC1B,WAAK,QAAQ,MAAM,+CAA+C;AAAA,IACpE;AAAA,EACF;AACF;",
  "names": []
}
