{
  "version": 3,
  "sources": ["../../../../../../../libs/connector-runner-file-source/src/lib/connector-runner-file-source.ts"],
  "sourcesContent": ["import { ConnectorRuntime } from '@transai/connector-runtime';\nimport {\n  ConnectSftpClient,\n  SftpClient,\n  SftpInterface,\n} from '@xip-online-data/sftp-client';\nimport { FilesourceProcessorService } from './filesource-processor/filesource-processor.service';\nimport { FileSourceProcessConfig, isYamlConfigType } from './types';\n\nexport class ConnectorRunnerFileSource extends ConnectorRuntime<FileSourceProcessConfig> {\n  readonly CONNECTOR_INSTANCE: string = 'XOD_CONNECTOR_FILE_SOURCE_CONFIG';\n\n  #processors: Array<FilesourceProcessorService> = [];\n\n  override init = async (): Promise<void> => {\n    if (!this.offsetStoreInstance) {\n      throw new Error(\n        'Offset store is not defined. Please provide an temp location for the offset store.',\n      );\n    }\n\n    const sftpClient: SftpInterface = this.config.forceReconnect\n      ? new ConnectSftpClient(this.config.sftpConfig, this.config)\n      : new SftpClient(this.config.sftpConfig, this.config);\n    await sftpClient.init();\n\n    this.#processors = await Promise.all(\n      this.config.directories.map(async (fileSourceConfig) => {\n        const processor = new FilesourceProcessorService(\n          fileSourceConfig,\n          this.config,\n          this.kafkaService,\n          sftpClient,\n        );\n        await processor.init();\n\n        return processor;\n      }),\n    );\n  };\n\n  override exit = async () => {\n    this.#processors.forEach((service) => service.stop());\n  };\n\n  override isValidConfig = (config: FileSourceProcessConfig): boolean => {\n    return isYamlConfigType(config);\n  };\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,+BAAiC;AACjC,yBAIO;AACP,kCAA2C;AAC3C,mBAA0D;AAEnD,MAAM,kCAAkC,0CAA0C;AAAA,EAAlF;AAAA;AACL,SAAS,qBAA6B;AAEtC,uBAAiD,CAAC;AAElD,SAAS,OAAO,YAA2B;AACzC,UAAI,CAAC,KAAK,qBAAqB;AAC7B,cAAM,IAAI;AAAA,UACR;AAAA,QACF;AAAA,MACF;AAEA,YAAM,aAA4B,KAAK,OAAO,iBAC1C,IAAI,qCAAkB,KAAK,OAAO,YAAY,KAAK,MAAM,IACzD,IAAI,8BAAW,KAAK,OAAO,YAAY,KAAK,MAAM;AACtD,YAAM,WAAW,KAAK;AAEtB,WAAK,cAAc,MAAM,QAAQ;AAAA,QAC/B,KAAK,OAAO,YAAY,IAAI,OAAO,qBAAqB;AACtD,gBAAM,YAAY,IAAI;AAAA,YACpB;AAAA,YACA,KAAK;AAAA,YACL,KAAK;AAAA,YACL;AAAA,UACF;AACA,gBAAM,UAAU,KAAK;AAErB,iBAAO;AAAA,QACT,CAAC;AAAA,MACH;AAAA,IACF;AAEA,SAAS,OAAO,YAAY;AAC1B,WAAK,YAAY,QAAQ,CAAC,YAAY,QAAQ,KAAK,CAAC;AAAA,IACtD;AAEA,SAAS,gBAAgB,CAAC,WAA6C;AACrE,iBAAO,+BAAiB,MAAM;AAAA,IAChC;AAAA;AAAA,EAnCA;AAoCF;",
  "names": []
}
