{
  "version": 3,
  "sources": ["../../../../../../../libs/logger/src/lib/logger.ts"],
  "sourcesContent": ["// eslint-disable-next-line import/no-extraneous-dependencies\nimport * as winston from 'winston';\nimport process from 'node:process';\n\nexport enum LogLevels {\n  error = 'error',\n  warn = 'warn',\n  info = 'info',\n  http = 'http',\n  verbose = 'verbose',\n  debug = 'debug',\n  silly = 'silly',\n}\n\nexport class Logger {\n  // eslint-disable-next-line no-use-before-define\n  private static instance: Logger;\n\n  private readonly logger: winston.Logger;\n\n  private constructor(\n    identifier: string,\n    loglevel: LogLevels = LogLevels.info,\n  ) {\n    this.logger = winston.createLogger({\n      level: loglevel,\n      format: winston.format.combine(\n        winston.format.label({ label: identifier }),\n        winston.format.timestamp(),\n        winston.format.json(),\n      ),\n    });\n\n    let transportsAdded = false;\n\n    if (\n      process.env['NODE_ENV'] !== 'production' ||\n      process.env['LOG_TO_CONSOLE'] === 'true'\n    ) {\n      transportsAdded = true;\n      this.logger.add(\n        new winston.transports.Console({\n          format: winston.format.printf(\n            ({ label, level, message }) => `[${label}] ${level}: ${message}`,\n          ),\n        }),\n      );\n    }\n\n    if (process.env['LOG_TO_FILE'] === 'true') {\n      transportsAdded = true;\n      this.logger.add(\n        new winston.transports.File({\n          filename: 'error.log',\n          level: LogLevels.error,\n        }),\n      );\n      this.logger.add(\n        new winston.transports.File({ filename: 'combined.log' }),\n      );\n    }\n\n    if (!transportsAdded) {\n      // Always add a transport to prevent memory leaks!\n      this.logger.add(\n        new winston.transports.Console({\n          format: winston.format.printf(\n            ({ label, level, message }) => `[${label}] ${level}: ${message}`,\n          ),\n        }),\n      );\n    }\n  }\n\n  static getInstance(identifier?: string, loglevel?: LogLevels): Logger {\n    if (!Logger.instance) {\n      Logger.instance = new Logger(\n        identifier ?? 'default',\n        Logger.#getLogLevel(loglevel),\n      );\n    }\n    return Logger.instance;\n  }\n\n  info(...args: Array<unknown>): void {\n    this.#logFunction(this.logger.info, ...args);\n  }\n\n  debug(...args: Array<unknown>): void {\n    this.#logFunction(this.logger.debug, ...args);\n  }\n\n  error(...args: Array<unknown>): void {\n    this.#logFunction(this.logger.error, ...args);\n  }\n\n  warn(...args: Array<unknown>): void {\n    this.#logFunction(this.logger.warn, ...args);\n  }\n\n  verbose(...args: Array<unknown>): void {\n    this.#logFunction(this.logger.verbose, ...args);\n  }\n\n  silly(...args: Array<unknown>): void {\n    this.#logFunction(this.logger.silly, ...args);\n  }\n\n  #logFunction(\n    func: (message: string, ...meta: Array<unknown>) => unknown,\n    ...meta: Array<unknown>\n  ) {\n    try {\n      const message = meta.map((param) =>\n        typeof param === 'object' ? JSON.stringify(param) : String(param),\n      );\n      func(message.join(' '), ...meta);\n    } catch (error) {\n      this.logger.error(error);\n    }\n  }\n\n  static #getLogLevel = (givenLevel?: LogLevels): LogLevels => {\n    if (givenLevel !== undefined) {\n      return givenLevel;\n    }\n\n    let logLevel = (process.env['LOG_LEVEL'] as LogLevels) || LogLevels.info;\n    const validLogLevels = Object.values(LogLevels);\n    const faultyLogLevel = !validLogLevels.includes(logLevel);\n\n    if (faultyLogLevel) {\n      logLevel = LogLevels.info;\n    }\n\n    if (faultyLogLevel) {\n      // Console since the logger is not yet setup\n      // eslint-disable-next-line no-console\n      console.error(\n        `Invalid log level: ${logLevel} only allow; 'error', 'warn', 'info', 'debug', 'trace'. Using info as default.`,\n      );\n    }\n\n    return logLevel;\n  };\n}\n"],
  "mappings": "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",
  "names": ["LogLevels", "process"]
}
