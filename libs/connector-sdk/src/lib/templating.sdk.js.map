{
  "version": 3,
  "sources": ["../../../../../../../libs/connector-sdk/src/lib/templating.sdk.ts"],
  "sourcesContent": ["import {\n  CompileDelegate,\n  CompileOptions,\n  TemplatingSDKInterface,\n} from '@transai/connector-runtime-sdk';\nimport Handlebars from 'handlebars';\nimport helpers from 'handlebars-helpers';\nimport jsonata from 'jsonata';\nimport moment from 'moment-timezone';\n\nexport class TemplatingSDKService implements TemplatingSDKInterface {\n  readonly #handlebarsInstance = Handlebars.create();\n\n  constructor() {\n    helpers({ handlebars: this.#handlebarsInstance });\n\n    this.#handlebarsInstance.registerHelper(\n      'getFirst',\n      (inputString, delimiter) => {\n        if (typeof inputString !== 'string' || typeof delimiter !== 'string') {\n          return inputString;\n        }\n\n        if (inputString.includes(delimiter)) {\n          return inputString.split(delimiter)[0];\n        }\n\n        return inputString;\n      },\n    );\n    this.#handlebarsInstance.registerHelper(\n      'formatDateInTimezone',\n      (datetimeString, timezone, format) => {\n        // Check if the format parameter is actually a Handlebars options object, which happens if no format is provided\n        if (typeof format === 'object') {\n          // If so, use moment's default format by not specifying a format string\n          // eslint-disable-next-line no-param-reassign\n          format = undefined; // This will make moment use its default ISO 8601 format\n        }\n\n        if (datetimeString === 'now') {\n          return moment().tz(timezone).format(format);\n        }\n\n        return moment(datetimeString).tz(timezone).format(format);\n      },\n    );\n    this.#handlebarsInstance.registerHelper('formatISODate', (timestamp) => {\n      const date = new Date(timestamp);\n      return date.toISOString();\n    });\n    this.#handlebarsInstance.registerHelper(\n      'datetimeToDecimalHours',\n      (datetimeString) => {\n        // Parse the datetime string into a Moment.js object, assuming UTC\n        const datetime = moment.parseZone(datetimeString);\n\n        // Calculate decimal hours\n        const hours = datetime.hours();\n        const minutes = datetime.minutes();\n        const seconds = datetime.seconds();\n        const decimalHours = hours + minutes / 60 + seconds / 3600;\n\n        // Return formatted decimal hours\n        return decimalHours.toFixed(2);\n      },\n    );\n    this.#handlebarsInstance.registerHelper(\n      'isFalse',\n      (value) => value === false || value === 'false',\n    );\n    this.#handlebarsInstance.registerHelper(\n      'isTrue',\n      (value) => value === true || value === 'true',\n    );\n    this.#handlebarsInstance.registerHelper(\n      'jsonata',\n      (value: string, expression: string) => {\n        try {\n          const expr = jsonata(expression);\n          const result = expr.evaluate(value);\n\n          if (typeof result === 'string' || typeof result === 'number') {\n            return result;\n          }\n\n          return JSON.stringify(result);\n        } catch (err) {\n          return `JSONata error: ${err.message}`;\n        }\n      },\n    );\n    this.#handlebarsInstance.registerHelper('jsonEscape', (v) =>\n      JSON.stringify(v).slice(1, -1),\n    );\n    this.#handlebarsInstance.registerHelper('json', (v) => JSON.stringify(v));\n  }\n\n  compile<T = unknown>(\n    input: string,\n    options?: CompileOptions,\n  ): CompileDelegate<T> {\n    return this.#handlebarsInstance.compile(input, options);\n  }\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAKA,wBAAuB;AACvB,gCAAoB;AACpB,qBAAoB;AACpB,6BAAmB;AAEZ,MAAM,qBAAuD;AAAA,EACzD,sBAAsB,kBAAAA,QAAW,OAAO;AAAA,EAEjD,cAAc;AACZ,kCAAAC,SAAQ,EAAE,YAAY,KAAK,oBAAoB,CAAC;AAEhD,SAAK,oBAAoB;AAAA,MACvB;AAAA,MACA,CAAC,aAAa,cAAc;AAC1B,YAAI,OAAO,gBAAgB,YAAY,OAAO,cAAc,UAAU;AACpE,iBAAO;AAAA,QACT;AAEA,YAAI,YAAY,SAAS,SAAS,GAAG;AACnC,iBAAO,YAAY,MAAM,SAAS,EAAE,CAAC;AAAA,QACvC;AAEA,eAAO;AAAA,MACT;AAAA,IACF;AACA,SAAK,oBAAoB;AAAA,MACvB;AAAA,MACA,CAAC,gBAAgB,UAAU,WAAW;AAEpC,YAAI,OAAO,WAAW,UAAU;AAG9B,mBAAS;AAAA,QACX;AAEA,YAAI,mBAAmB,OAAO;AAC5B,qBAAO,uBAAAC,SAAO,EAAE,GAAG,QAAQ,EAAE,OAAO,MAAM;AAAA,QAC5C;AAEA,mBAAO,uBAAAA,SAAO,cAAc,EAAE,GAAG,QAAQ,EAAE,OAAO,MAAM;AAAA,MAC1D;AAAA,IACF;AACA,SAAK,oBAAoB,eAAe,iBAAiB,CAAC,cAAc;AACtE,YAAM,OAAO,IAAI,KAAK,SAAS;AAC/B,aAAO,KAAK,YAAY;AAAA,IAC1B,CAAC;AACD,SAAK,oBAAoB;AAAA,MACvB;AAAA,MACA,CAAC,mBAAmB;AAElB,cAAM,WAAW,uBAAAA,QAAO,UAAU,cAAc;AAGhD,cAAM,QAAQ,SAAS,MAAM;AAC7B,cAAM,UAAU,SAAS,QAAQ;AACjC,cAAM,UAAU,SAAS,QAAQ;AACjC,cAAM,eAAe,QAAQ,UAAU,KAAK,UAAU;AAGtD,eAAO,aAAa,QAAQ,CAAC;AAAA,MAC/B;AAAA,IACF;AACA,SAAK,oBAAoB;AAAA,MACvB;AAAA,MACA,CAAC,UAAU,UAAU,SAAS,UAAU;AAAA,IAC1C;AACA,SAAK,oBAAoB;AAAA,MACvB;AAAA,MACA,CAAC,UAAU,UAAU,QAAQ,UAAU;AAAA,IACzC;AACA,SAAK,oBAAoB;AAAA,MACvB;AAAA,MACA,CAAC,OAAe,eAAuB;AACrC,YAAI;AACF,gBAAM,WAAO,eAAAC,SAAQ,UAAU;AAC/B,gBAAM,SAAS,KAAK,SAAS,KAAK;AAElC,cAAI,OAAO,WAAW,YAAY,OAAO,WAAW,UAAU;AAC5D,mBAAO;AAAA,UACT;AAEA,iBAAO,KAAK,UAAU,MAAM;AAAA,QAC9B,SAAS,KAAK;AACZ,iBAAO,kBAAkB,IAAI,OAAO;AAAA,QACtC;AAAA,MACF;AAAA,IACF;AACA,SAAK,oBAAoB;AAAA,MAAe;AAAA,MAAc,CAAC,MACrD,KAAK,UAAU,CAAC,EAAE,MAAM,GAAG,EAAE;AAAA,IAC/B;AACA,SAAK,oBAAoB,eAAe,QAAQ,CAAC,MAAM,KAAK,UAAU,CAAC,CAAC;AAAA,EAC1E;AAAA,EAEA,QACE,OACA,SACoB;AACpB,WAAO,KAAK,oBAAoB,QAAQ,OAAO,OAAO;AAAA,EACxD;AACF;",
  "names": ["Handlebars", "helpers", "moment", "jsonata"]
}
