{
  "version": 3,
  "sources": ["../../../../../../../libs/connector-sdk/src/lib/sender.sdk.ts"],
  "sourcesContent": ["import {\n  Context,\n  Metadata,\n  Metric,\n  Result,\n  SenderSDKInterface,\n} from '@transai/connector-runtime-sdk';\nimport { KafkaSourceInterface } from '@xip-online-data/kafka-base-service';\nimport {\n  BaseConnectorConfig,\n  XodSourceMessageType,\n} from '@xip-online-data/types';\nimport { v4 as uuidv4 } from 'uuid';\n\nexport class SenderSDKService implements SenderSDKInterface {\n  readonly #connectorConfig: BaseConnectorConfig;\n\n  readonly #kafkaServiceInstance!: KafkaSourceInterface;\n\n  constructor(\n    apiConfig: BaseConnectorConfig,\n    kafkaServiceInstance: KafkaSourceInterface,\n  ) {\n    this.#connectorConfig = apiConfig;\n    this.#kafkaServiceInstance = kafkaServiceInstance;\n  }\n\n  metrics(\n    metrics: Array<Metric>,\n    metadata?: Metadata,\n    context?: Context,\n  ): Promise<Result> {\n    const kafkaPayload = metrics.map(\n      (body): XodSourceMessageType => ({\n        type: 'SOURCE',\n        eventId: uuidv4(),\n        eventType: 'event.metric',\n        created: context.timestamp?.getTime() ?? Date.now(),\n        ttl: context.ttl ?? -1,\n        tenantIdentifier: this.#connectorConfig.tenantIdentifier,\n        payload: {\n          ...(context.extraPayload ?? {}),\n          body: {\n            [body.key]: body.value,\n          },\n          metadata,\n        },\n      }),\n    );\n\n    return this.#kafkaServiceInstance.send(\n      kafkaPayload,\n      `${this.#connectorConfig.tenantIdentifier}_SOURCE_${this.#connectorConfig.datasourceIdentifier}`,\n    );\n  }\n\n  metricsLegacy(\n    metrics: Array<never>,\n    metadata?: Metadata,\n    context?: Context,\n  ): Promise<Result> {\n    const kafkaPayload = metrics.map(\n      (body): XodSourceMessageType => ({\n        type: 'SOURCE',\n        eventId: uuidv4(),\n        eventType: 'event.metric',\n        created: context.timestamp?.getTime() ?? Date.now(),\n        ttl: context.ttl ?? -1,\n        tenantIdentifier: this.#connectorConfig.tenantIdentifier,\n        payload: {\n          ...(context.extraPayload ?? {}),\n          body,\n          metadata,\n        },\n      }),\n    );\n\n    return this.#kafkaServiceInstance.send(\n      kafkaPayload,\n      `${this.#connectorConfig.tenantIdentifier}_SOURCE_${this.#connectorConfig.datasourceIdentifier}`,\n    );\n  }\n\n  documents(\n    records: Array<{\n      [key: string]: unknown;\n    }>,\n    metadata?: Metadata,\n    context?: Context,\n  ): Promise<boolean> {\n    const kafkaPayload = records.map((record): XodSourceMessageType => {\n      return {\n        type: 'SOURCE',\n        eventId: uuidv4(),\n        eventType: 'event.source-sink.kafka',\n        created: context.timestamp?.getTime() ?? Date.now(),\n        ttl: context.ttl ?? 3_600_000, // 1 month\n        tenantIdentifier: this.#connectorConfig.tenantIdentifier,\n        payload: {\n          ...(context.extraPayload ?? {}),\n          body: record,\n          metadata,\n        },\n      };\n    });\n\n    return this.#kafkaServiceInstance.send(\n      kafkaPayload,\n      `${this.#connectorConfig.tenantIdentifier}_SOURCE_${this.#connectorConfig.datasourceIdentifier}`,\n    );\n  }\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAYA,kBAA6B;AAEtB,MAAM,iBAA+C;AAAA,EACjD;AAAA,EAEA;AAAA,EAET,YACE,WACA,sBACA;AACA,SAAK,mBAAmB;AACxB,SAAK,wBAAwB;AAAA,EAC/B;AAAA,EAEA,QACE,SACA,UACA,SACiB;AACjB,UAAM,eAAe,QAAQ;AAAA,MAC3B,CAAC,UAAgC;AAAA,QAC/B,MAAM;AAAA,QACN,aAAS,YAAAA,IAAO;AAAA,QAChB,WAAW;AAAA,QACX,SAAS,QAAQ,WAAW,QAAQ,KAAK,KAAK,IAAI;AAAA,QAClD,KAAK,QAAQ,OAAO;AAAA,QACpB,kBAAkB,KAAK,iBAAiB;AAAA,QACxC,SAAS;AAAA,UACP,GAAI,QAAQ,gBAAgB,CAAC;AAAA,UAC7B,MAAM;AAAA,YACJ,CAAC,KAAK,GAAG,GAAG,KAAK;AAAA,UACnB;AAAA,UACA;AAAA,QACF;AAAA,MACF;AAAA,IACF;AAEA,WAAO,KAAK,sBAAsB;AAAA,MAChC;AAAA,MACA,GAAG,KAAK,iBAAiB,gBAAgB,WAAW,KAAK,iBAAiB,oBAAoB;AAAA,IAChG;AAAA,EACF;AAAA,EAEA,cACE,SACA,UACA,SACiB;AACjB,UAAM,eAAe,QAAQ;AAAA,MAC3B,CAAC,UAAgC;AAAA,QAC/B,MAAM;AAAA,QACN,aAAS,YAAAA,IAAO;AAAA,QAChB,WAAW;AAAA,QACX,SAAS,QAAQ,WAAW,QAAQ,KAAK,KAAK,IAAI;AAAA,QAClD,KAAK,QAAQ,OAAO;AAAA,QACpB,kBAAkB,KAAK,iBAAiB;AAAA,QACxC,SAAS;AAAA,UACP,GAAI,QAAQ,gBAAgB,CAAC;AAAA,UAC7B;AAAA,UACA;AAAA,QACF;AAAA,MACF;AAAA,IACF;AAEA,WAAO,KAAK,sBAAsB;AAAA,MAChC;AAAA,MACA,GAAG,KAAK,iBAAiB,gBAAgB,WAAW,KAAK,iBAAiB,oBAAoB;AAAA,IAChG;AAAA,EACF;AAAA,EAEA,UACE,SAGA,UACA,SACkB;AAClB,UAAM,eAAe,QAAQ,IAAI,CAAC,WAAiC;AACjE,aAAO;AAAA,QACL,MAAM;AAAA,QACN,aAAS,YAAAA,IAAO;AAAA,QAChB,WAAW;AAAA,QACX,SAAS,QAAQ,WAAW,QAAQ,KAAK,KAAK,IAAI;AAAA,QAClD,KAAK,QAAQ,OAAO;AAAA;AAAA,QACpB,kBAAkB,KAAK,iBAAiB;AAAA,QACxC,SAAS;AAAA,UACP,GAAI,QAAQ,gBAAgB,CAAC;AAAA,UAC7B,MAAM;AAAA,UACN;AAAA,QACF;AAAA,MACF;AAAA,IACF,CAAC;AAED,WAAO,KAAK,sBAAsB;AAAA,MAChC;AAAA,MACA,GAAG,KAAK,iBAAiB,gBAAgB,WAAW,KAAK,iBAAiB,oBAAoB;AAAA,IAChG;AAAA,EACF;AACF;",
  "names": ["uuidv4"]
}
