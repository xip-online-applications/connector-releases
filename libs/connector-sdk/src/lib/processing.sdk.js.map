{
  "version": 3,
  "sources": ["../../../../../../../libs/connector-sdk/src/lib/processing.sdk.ts"],
  "sourcesContent": ["import {\n  IntervalHandler,\n  LoggerSDKInterface,\n  ProcessingSDKInterface,\n  RegisterIntervalOptions,\n} from '@transai/connector-runtime-sdk';\nimport { interval, Subscription } from 'rxjs';\n\nexport class ProcessingSDKService implements ProcessingSDKInterface {\n  readonly #logger: LoggerSDKInterface;\n\n  readonly #intervals: {\n    [id: string]: {\n      subscription: Subscription;\n      handler: IntervalHandler;\n    };\n  } = {};\n\n  constructor(logger: LoggerSDKInterface) {\n    this.#logger = logger;\n  }\n\n  async registerInterval(\n    intervalSeconds: number,\n    handler: IntervalHandler,\n    options?: RegisterIntervalOptions,\n  ): Promise<string> {\n    const name =\n      handler?.name ?? `interval-${Object.keys(this.#intervals).length + 1}`;\n\n    // eslint-disable-next-line security/detect-object-injection\n    if (this.#intervals[name]) {\n      throw new Error(`Interval with name ${name} already exists`);\n    }\n\n    // eslint-disable-next-line security/detect-object-injection\n    this.#intervals[name] = {\n      handler,\n      subscription: interval(intervalSeconds * 1_000).subscribe(async () => {\n        await this.#runHandler(handler);\n      }),\n    };\n\n    if (options?.immediate) {\n      await this.#runHandler(handler);\n    }\n\n    return name;\n  }\n\n  async #runHandler(handler: IntervalHandler): Promise<void> {\n    try {\n      await handler.onRun();\n    } catch (error) {\n      this.#logger.error(\n        `Error running interval handler ${handler.name}: ${\n          (error as Error).message\n        }`,\n      );\n    }\n  }\n\n  async stopInterval(name: string): Promise<void> {\n    // eslint-disable-next-line security/detect-object-injection\n    const interval = this.#intervals[name];\n    if (!interval) {\n      return;\n    }\n\n    interval.subscription.unsubscribe();\n    if (interval.handler.onStop !== undefined) {\n      await interval.handler.onStop();\n    }\n\n    // eslint-disable-next-line security/detect-object-injection\n    delete this.#intervals[name];\n  }\n\n  stopAll(): Promise<unknown> {\n    const stopPromises = Object.keys(this.#intervals).map((name) =>\n      this.stopInterval(name),\n    );\n\n    return Promise.all(stopPromises);\n  }\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAMA,kBAAuC;AAEhC,MAAM,qBAAuD;AAAA,EACzD;AAAA,EAEA,aAKL,CAAC;AAAA,EAEL,YAAY,QAA4B;AACtC,SAAK,UAAU;AAAA,EACjB;AAAA,EAEA,MAAM,iBACJ,iBACA,SACA,SACiB;AACjB,UAAM,OACJ,SAAS,QAAQ,YAAY,OAAO,KAAK,KAAK,UAAU,EAAE,SAAS,CAAC;AAGtE,QAAI,KAAK,WAAW,IAAI,GAAG;AACzB,YAAM,IAAI,MAAM,sBAAsB,IAAI,iBAAiB;AAAA,IAC7D;AAGA,SAAK,WAAW,IAAI,IAAI;AAAA,MACtB;AAAA,MACA,kBAAc,sBAAS,kBAAkB,GAAK,EAAE,UAAU,YAAY;AACpE,cAAM,KAAK,YAAY,OAAO;AAAA,MAChC,CAAC;AAAA,IACH;AAEA,QAAI,SAAS,WAAW;AACtB,YAAM,KAAK,YAAY,OAAO;AAAA,IAChC;AAEA,WAAO;AAAA,EACT;AAAA,EAEA,MAAM,YAAY,SAAyC;AACzD,QAAI;AACF,YAAM,QAAQ,MAAM;AAAA,IACtB,SAAS,OAAO;AACd,WAAK,QAAQ;AAAA,QACX,kCAAkC,QAAQ,IAAI,KAC3C,MAAgB,OACnB;AAAA,MACF;AAAA,IACF;AAAA,EACF;AAAA,EAEA,MAAM,aAAa,MAA6B;AAE9C,UAAMA,YAAW,KAAK,WAAW,IAAI;AACrC,QAAI,CAACA,WAAU;AACb;AAAA,IACF;AAEA,IAAAA,UAAS,aAAa,YAAY;AAClC,QAAIA,UAAS,QAAQ,WAAW,QAAW;AACzC,YAAMA,UAAS,QAAQ,OAAO;AAAA,IAChC;AAGA,WAAO,KAAK,WAAW,IAAI;AAAA,EAC7B;AAAA,EAEA,UAA4B;AAC1B,UAAM,eAAe,OAAO,KAAK,KAAK,UAAU,EAAE;AAAA,MAAI,CAAC,SACrD,KAAK,aAAa,IAAI;AAAA,IACxB;AAEA,WAAO,QAAQ,IAAI,YAAY;AAAA,EACjC;AACF;",
  "names": ["interval"]
}
