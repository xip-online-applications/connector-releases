{
  "version": 3,
  "sources": ["../../../../../../../libs/datasource/src/lib/datasource.service.ts"],
  "sourcesContent": ["import { Driver } from './driver/driver';\nimport { DatasourceOptions } from './datasource.options';\nimport { DriverFactory } from './driver/driver.factory';\nimport { QueryRunnerInterface } from './driver/query-runner.interface';\nimport { QueryResult } from './driver/query-result';\n\nexport class DatasourceService {\n  readonly name: string;\n\n  readonly options: DatasourceOptions;\n\n  isInitialized: boolean;\n\n  driver: Driver;\n\n  constructor(options: DatasourceOptions) {\n    this.isInitialized = false;\n    this.options = options;\n    this.name = options.name || 'default';\n    this.driver = DriverFactory.create(this);\n  }\n\n  get version(): string {\n    return `${this.options.type} : ${this.driver.version}`;\n  }\n\n  async initialize(): Promise<this> {\n    if (this.isInitialized) throw new Error(this.name);\n\n    // connect to the database via its driver\n    await this.driver.connect();\n    await this.driver.afterConnect();\n    this.isInitialized = true;\n\n    return this;\n  }\n\n  /**\n   * Executes raw SQL query and returns raw database results.\n   */\n  async query(\n    query: string,\n    parameters?: Array<any>,\n  ): Promise<QueryResult | null | { error: string }> {\n    const usedQueryRunner = this.createQueryRunner();\n    let result = null;\n\n    try {\n      // await is needed here because we are using finally\n      result = await usedQueryRunner\n        .query(query, parameters)\n        .catch(async (error) => {\n          await usedQueryRunner.release();\n          throw error;\n        });\n    } catch (error) {\n      if (error instanceof Error) {\n        return {\n          error: error.message,\n        };\n      }\n\n      return {\n        error: 'Unknown error occurred while executing query',\n      };\n    } finally {\n      await usedQueryRunner.release();\n    }\n\n    return result;\n  }\n\n  createQueryRunner(): QueryRunnerInterface {\n    return this.driver.createQueryRunner();\n  }\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA,IAAAA,iBAA8B;AAIvB,MAAM,kBAAkB;AAAA,EAS7B,YAAY,SAA4B;AACtC,SAAK,gBAAgB;AACrB,SAAK,UAAU;AACf,SAAK,OAAO,QAAQ,QAAQ;AAC5B,SAAK,SAAS,6BAAc,OAAO,IAAI;AAAA,EACzC;AAAA,EAEA,IAAI,UAAkB;AACpB,WAAO,GAAG,KAAK,QAAQ,IAAI,MAAM,KAAK,OAAO,OAAO;AAAA,EACtD;AAAA,EAEA,MAAM,aAA4B;AAChC,QAAI,KAAK;AAAe,YAAM,IAAI,MAAM,KAAK,IAAI;AAGjD,UAAM,KAAK,OAAO,QAAQ;AAC1B,UAAM,KAAK,OAAO,aAAa;AAC/B,SAAK,gBAAgB;AAErB,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,MACJ,OACA,YACiD;AACjD,UAAM,kBAAkB,KAAK,kBAAkB;AAC/C,QAAI,SAAS;AAEb,QAAI;AAEF,eAAS,MAAM,gBACZ,MAAM,OAAO,UAAU,EACvB,MAAM,OAAO,UAAU;AACtB,cAAM,gBAAgB,QAAQ;AAC9B,cAAM;AAAA,MACR,CAAC;AAAA,IACL,SAAS,OAAO;AACd,UAAI,iBAAiB,OAAO;AAC1B,eAAO;AAAA,UACL,OAAO,MAAM;AAAA,QACf;AAAA,MACF;AAEA,aAAO;AAAA,QACL,OAAO;AAAA,MACT;AAAA,IACF,UAAE;AACA,YAAM,gBAAgB,QAAQ;AAAA,IAChC;AAEA,WAAO;AAAA,EACT;AAAA,EAEA,oBAA0C;AACxC,WAAO,KAAK,OAAO,kBAAkB;AAAA,EACvC;AACF;",
  "names": ["import_driver"]
}
