{
  "version": 3,
  "sources": ["../../../../../../../libs/connector-runner-dummy-sink/src/lib/connector-runner-dummy-sink.ts"],
  "sourcesContent": ["import { ConnectorRuntime } from '@transai/connector-runtime';\nimport {\n  BaseConnectorConfig,\n  KafkaCallbackResponse,\n  XodActionType,\n  XodBaseMessageType,\n} from '@xip-online-data/types';\nimport { InternalServerError, Ok } from '@xip-online-data/kafka-base-service';\nimport { Logger } from '@transai/logger';\n\nexport class ConnectorRunnerDummySink extends ConnectorRuntime<{\n  failProbability?: number;\n}> {\n  readonly CONNECTOR_INSTANCE: string = 'XOD_CONNECTOR_DUMMY_SINK_CONFIG';\n\n  override getConfig = async (): Promise<{} & BaseConnectorConfig> => ({\n    processIdentifier: this.CONNECTOR_IDENTIFIER,\n    tenantIdentifier: 'dummy-tenant',\n    datasourceIdentifier: 'dummy-source',\n    kafka: {\n      brokers: ['localhost:9092'],\n      groupId: 'dummy-sink',\n      clientId: 'dummy-sink',\n      consumerTopics: [\n        {\n          pattern: '_source_',\n          flags: 'i',\n        },\n      ],\n    },\n    debug: false,\n  });\n\n  override init = async (): Promise<void> => {\n    const config = this.config!;\n\n    const failProbability = config.failProbability || 0.0;\n    if (failProbability > 0) {\n      Logger.getInstance().debug('Fail probability set to', failProbability);\n    }\n\n    const dummyProcessFailed = () => {\n      return Math.random() < failProbability;\n    };\n\n    const mainCallbackFunction: (\n      callbackFunction: (\n        message: XodActionType,\n      ) => Promise<KafkaCallbackResponse>,\n    ) => (message: XodActionType) => Promise<KafkaCallbackResponse> = (\n      callbackFunction: (\n        message: XodActionType,\n      ) => Promise<KafkaCallbackResponse>,\n    ) => {\n      return async (message: XodActionType) => {\n        Logger.getInstance().info(\n          'Received message: ',\n          message.testRun ? '(test run)' : '',\n          message.eventId,\n          message.payload,\n        );\n\n        if (dummyProcessFailed()) {\n          Logger.getInstance().error('Dummy process failed');\n          return InternalServerError('Dummy process failed')(message);\n        }\n\n        return callbackFunction(message);\n      };\n    };\n\n    this.callbackFunction = mainCallbackFunction(this.emitEventType(Ok())) as (\n      message: XodBaseMessageType,\n    ) => Promise<KafkaCallbackResponse>;\n  };\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,+BAAiC;AAOjC,gCAAwC;AACxC,oBAAuB;AAEhB,MAAM,iCAAiC,0CAE3C;AAAA,EAFI;AAAA;AAGL,SAAS,qBAA6B;AAEtC,SAAS,YAAY,aAAgD;AAAA,MACnE,mBAAmB,KAAK;AAAA,MACxB,kBAAkB;AAAA,MAClB,sBAAsB;AAAA,MACtB,OAAO;AAAA,QACL,SAAS,CAAC,gBAAgB;AAAA,QAC1B,SAAS;AAAA,QACT,UAAU;AAAA,QACV,gBAAgB;AAAA,UACd;AAAA,YACE,SAAS;AAAA,YACT,OAAO;AAAA,UACT;AAAA,QACF;AAAA,MACF;AAAA,MACA,OAAO;AAAA,IACT;AAEA,SAAS,OAAO,YAA2B;AACzC,YAAM,SAAS,KAAK;AAEpB,YAAM,kBAAkB,OAAO,mBAAmB;AAClD,UAAI,kBAAkB,GAAG;AACvB,6BAAO,YAAY,EAAE,MAAM,2BAA2B,eAAe;AAAA,MACvE;AAEA,YAAM,qBAAqB,MAAM;AAC/B,eAAO,KAAK,OAAO,IAAI;AAAA,MACzB;AAEA,YAAM,uBAI4D,CAChE,qBAGG;AACH,eAAO,OAAO,YAA2B;AACvC,+BAAO,YAAY,EAAE;AAAA,YACnB;AAAA,YACA,QAAQ,UAAU,eAAe;AAAA,YACjC,QAAQ;AAAA,YACR,QAAQ;AAAA,UACV;AAEA,cAAI,mBAAmB,GAAG;AACxB,iCAAO,YAAY,EAAE,MAAM,sBAAsB;AACjD,uBAAO,+CAAoB,sBAAsB,EAAE,OAAO;AAAA,UAC5D;AAEA,iBAAO,iBAAiB,OAAO;AAAA,QACjC;AAAA,MACF;AAEA,WAAK,mBAAmB,qBAAqB,KAAK,kBAAc,8BAAG,CAAC,CAAC;AAAA,IAGvE;AAAA;AACF;",
  "names": []
}
