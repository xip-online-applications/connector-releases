{
  "version": 3,
  "sources": ["../../../../../../../libs/helper-functions/src/lib/sentry.ts"],
  "sourcesContent": ["import {\n  ArgumentsHost,\n  Catch,\n  INestApplication,\n  INestMicroservice,\n} from '@nestjs/common';\nimport { BaseExceptionFilter, HttpAdapterHost } from '@nestjs/core';\nimport * as Sentry from '@sentry/node';\nimport { HttpException } from '@nestjs/common/exceptions/http.exception';\n\nexport interface SentryConfig {\n  dsn?: string;\n  environment?: string;\n  release?: string;\n  tracesSampleRate?: number;\n}\n\nexport function register(\n  app: INestApplication | INestMicroservice,\n  options: SentryConfig = {},\n) {\n  const dsn = options.dsn ?? process.env['SENTRY_DSN'];\n  if (!dsn) {\n    return;\n  }\n\n  const { httpAdapter } = app.get(HttpAdapterHost);\n  app.useGlobalFilters(new SentryFilter(httpAdapter));\n}\n\nexport function init(options: SentryConfig = {}) {\n  const dsn = options.dsn ?? process.env['SENTRY_DSN'];\n  if (!dsn) {\n    return;\n  }\n\n  Sentry.init({\n    dsn,\n    environment:\n      options.environment ??\n      process.env['SENTRY_ENVIRONMENT'] ??\n      process.env['NODE_ENV'] ??\n      'dev',\n    release: options.release ?? process.env['SENTRY_RELEASE'] ?? 'unknown',\n    tracesSampleRate: options.tracesSampleRate ?? 1.0,\n  });\n}\n\n@Catch()\nexport class SentryFilter extends BaseExceptionFilter {\n  override catch(exception: unknown, host: ArgumentsHost) {\n    if (exception instanceof HttpException) {\n      const error = exception as HttpException;\n      const statusCode = error.getStatus();\n      if (statusCode >= 500) {\n        Sentry.captureException(exception, {\n          tags: {\n            status_code: statusCode,\n          },\n        });\n      }\n    } else {\n      Sentry.captureException(exception);\n    }\n\n    super.catch(exception, host);\n  }\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBAKO;AACP,kBAAqD;AACrD,aAAwB;AACxB,kBAA8B;AASvB,SAAS,SACd,KACA,UAAwB,CAAC,GACzB;AACA,QAAM,MAAM,QAAQ,OAAO,QAAQ,IAAI,YAAY;AACnD,MAAI,CAAC,KAAK;AACR;AAAA,EACF;AAEA,QAAM,EAAE,YAAY,IAAI,IAAI,IAAI,2BAAe;AAC/C,MAAI,iBAAiB,IAAI,aAAa,WAAW,CAAC;AACpD;AAEO,SAAS,KAAK,UAAwB,CAAC,GAAG;AAC/C,QAAM,MAAM,QAAQ,OAAO,QAAQ,IAAI,YAAY;AACnD,MAAI,CAAC,KAAK;AACR;AAAA,EACF;AAEA,SAAO,KAAK;AAAA,IACV;AAAA,IACA,aACE,QAAQ,eACR,QAAQ,IAAI,oBAAoB,KAChC,QAAQ,IAAI,UAAU,KACtB;AAAA,IACF,SAAS,QAAQ,WAAW,QAAQ,IAAI,gBAAgB,KAAK;AAAA,IAC7D,kBAAkB,QAAQ,oBAAoB;AAAA,EAChD,CAAC;AACH;AAGO,IAAM,eAAN,cAA2B,gCAAoB;AAAA,EAC3C,MAAM,WAAoB,MAAqB;AACtD,QAAI,qBAAqB,2BAAe;AACtC,YAAM,QAAQ;AACd,YAAM,aAAa,MAAM,UAAU;AACnC,UAAI,cAAc,KAAK;AACrB,eAAO,iBAAiB,WAAW;AAAA,UACjC,MAAM;AAAA,YACJ,aAAa;AAAA,UACf;AAAA,QACF,CAAC;AAAA,MACH;AAAA,IACF,OAAO;AACL,aAAO,iBAAiB,SAAS;AAAA,IACnC;AAEA,UAAM,MAAM,WAAW,IAAI;AAAA,EAC7B;AACF;AAlBa,eAAN;AAAA,MADN,qBAAM;AAAA,GACM;",
  "names": []
}
