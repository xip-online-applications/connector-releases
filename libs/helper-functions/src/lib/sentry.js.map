{
  "version": 3,
  "sources": ["../../../../../../../libs/helper-functions/src/lib/sentry.ts"],
  "sourcesContent": ["import {ArgumentsHost, Catch, INestApplication, INestMicroservice} from \"@nestjs/common\";\nimport {BaseExceptionFilter, HttpAdapterHost} from \"@nestjs/core\";\nimport * as Sentry from '@sentry/node';\n\nexport interface SentryConfig {\n  dsn?: string;\n  environment?: string;\n  release?: string;\n  tracesSampleRate?: number;\n}\n\nexport function register(app: INestApplication | INestMicroservice, options: SentryConfig = {}) {\n  const dsn = options.dsn ?? process.env['SENTRY_DSN'];\n  if (!dsn) {\n    return;\n  }\n\n  const { httpAdapter } = app.get(HttpAdapterHost);\n  app.useGlobalFilters(new SentryFilter(httpAdapter));\n}\n\nexport function init(options: SentryConfig = {}) {\n  const dsn = options.dsn ?? process.env['SENTRY_DSN'];\n  if (!dsn) {\n    return;\n  }\n\n  Sentry.init({\n    dsn,\n    environment: options.environment ?? process.env['SENTRY_ENVIRONMENT'] ?? process.env['NODE_ENV'] ?? 'dev',\n    release: options.release ?? process.env['SENTRY_RELEASE'] ?? 'unknown',\n    tracesSampleRate: options.tracesSampleRate ?? 1.0,\n  });\n}\n\n@Catch()\nexport class SentryFilter extends BaseExceptionFilter {\n  override catch(exception: unknown, host: ArgumentsHost) {\n    Sentry.captureException(exception);\n    super.catch(exception, host);\n  }\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBAAwE;AACxE,kBAAmD;AACnD,aAAwB;AASjB,SAAS,SAAS,KAA2C,UAAwB,CAAC,GAAG;AAC9F,QAAM,MAAM,QAAQ,OAAO,QAAQ,IAAI,YAAY;AACnD,MAAI,CAAC,KAAK;AACR;AAAA,EACF;AAEA,QAAM,EAAE,YAAY,IAAI,IAAI,IAAI,2BAAe;AAC/C,MAAI,iBAAiB,IAAI,aAAa,WAAW,CAAC;AACpD;AAEO,SAAS,KAAK,UAAwB,CAAC,GAAG;AAC/C,QAAM,MAAM,QAAQ,OAAO,QAAQ,IAAI,YAAY;AACnD,MAAI,CAAC,KAAK;AACR;AAAA,EACF;AAEA,SAAO,KAAK;AAAA,IACV;AAAA,IACA,aAAa,QAAQ,eAAe,QAAQ,IAAI,oBAAoB,KAAK,QAAQ,IAAI,UAAU,KAAK;AAAA,IACpG,SAAS,QAAQ,WAAW,QAAQ,IAAI,gBAAgB,KAAK;AAAA,IAC7D,kBAAkB,QAAQ,oBAAoB;AAAA,EAChD,CAAC;AACH;AAGO,IAAM,eAAN,cAA2B,gCAAoB;AAAA,EAC3C,MAAM,WAAoB,MAAqB;AACtD,WAAO,iBAAiB,SAAS;AACjC,UAAM,MAAM,WAAW,IAAI;AAAA,EAC7B;AACF;AALa,eAAN;AAAA,MADN,qBAAM;AAAA,GACM;",
  "names": []
}
