{
  "version": 3,
  "sources": ["../../../../../../../libs/httpclient/src/lib/builder.service.ts"],
  "sourcesContent": ["import { HttpService } from './http.service';\nimport { JwtTokenService } from './token';\nimport {\n  ArrayCacheService,\n  CacheServiceInterface,\n  RedisCacheService,\n} from './cache';\nimport { HttpServiceInterface } from './interface';\nimport { FileSystemCacheService } from './cache/filesystem-cache.service';\n\nexport interface HttpServiceBuilderOptions {\n  baseUrl: string;\n  jwt: JwtBuilderOptions;\n  cache?: CacheBuilderOptions;\n}\n\nexport interface HttpServiceBuilderFromEnvOptions {\n  baseUrl: string;\n  audience: string;\n  tenantIdentifier?: string;\n}\n\nexport interface JwtBuilderOptions {\n  tokenUrl: string;\n  clientId: string;\n  clientSecret: string;\n  audience?: string;\n  tenantIdentifier?: string;\n}\n\nexport interface CacheBuilderOptions {\n  type?: 'memory' | 'redis' | 'filesystem' | string;\n  redisUrl?: string;\n  keyPrefix?: string;\n  path?: string;\n}\n\nexport class HttpServiceBuilder {\n  public static build(\n    options: HttpServiceBuilderOptions,\n  ): HttpServiceInterface {\n    const cacheService = HttpServiceBuilder.buildCacheService(\n      options.cache ?? {},\n    );\n    const jwtTokenService = HttpServiceBuilder.buildJwtTokenService(\n      options.jwt,\n      cacheService,\n    );\n\n    return new HttpService(jwtTokenService, {\n      baseUrl: options.baseUrl,\n      tenantIdentifier: options.jwt.tenantIdentifier,\n    });\n  }\n\n  public static buildFromEnv(\n    options: HttpServiceBuilderFromEnvOptions,\n  ): HttpServiceInterface {\n    return HttpServiceBuilder.build({\n      baseUrl: options.baseUrl,\n      jwt: {\n        tokenUrl: <string>process.env['AUTH0_TOKEN_URL'],\n        clientId: <string>process.env['AUTH0_CLIENT_ID'],\n        clientSecret: <string>process.env['AUTH0_CLIENT_SECRET'],\n        audience: options.audience,\n        tenantIdentifier: options.tenantIdentifier,\n      },\n      cache: {\n        type: process.env['REDIS_URL'] ? 'redis' : 'memory',\n        redisUrl: process.env['REDIS_URL'],\n        keyPrefix: process.env['CACHE_KEY_PREFIX'],\n      },\n    });\n  }\n\n  public static buildJwtTokenService(\n    options: JwtBuilderOptions,\n    cacheService: CacheServiceInterface,\n  ) {\n    return new JwtTokenService(options, cacheService);\n  }\n\n  public static buildCacheService(\n    options: CacheBuilderOptions = {},\n  ): CacheServiceInterface {\n    switch (options.type) {\n      case 'redis':\n        return new RedisCacheService(String(options.redisUrl), {\n          cacheKeyPrefix: options.keyPrefix,\n        });\n      case 'filesystem':\n        return new FileSystemCacheService({\n          path: options.path ?? './cache',\n          keyPrefix: options.keyPrefix,\n        });\n      default:\n        return new ArrayCacheService();\n    }\n  }\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAA4B;AAC5B,mBAAgC;AAChC,mBAIO;AAEP,8BAAuC;AA6BhC,MAAM,mBAAmB;AAAA,EAC9B,OAAc,MACZ,SACsB;AACtB,UAAM,eAAe,mBAAmB;AAAA,MACtC,QAAQ,SAAS,CAAC;AAAA,IACpB;AACA,UAAM,kBAAkB,mBAAmB;AAAA,MACzC,QAAQ;AAAA,MACR;AAAA,IACF;AAEA,WAAO,IAAI,wBAAY,iBAAiB;AAAA,MACtC,SAAS,QAAQ;AAAA,MACjB,kBAAkB,QAAQ,IAAI;AAAA,IAChC,CAAC;AAAA,EACH;AAAA,EAEA,OAAc,aACZ,SACsB;AACtB,WAAO,mBAAmB,MAAM;AAAA,MAC9B,SAAS,QAAQ;AAAA,MACjB,KAAK;AAAA,QACH,UAAkB,QAAQ,IAAI,iBAAiB;AAAA,QAC/C,UAAkB,QAAQ,IAAI,iBAAiB;AAAA,QAC/C,cAAsB,QAAQ,IAAI,qBAAqB;AAAA,QACvD,UAAU,QAAQ;AAAA,QAClB,kBAAkB,QAAQ;AAAA,MAC5B;AAAA,MACA,OAAO;AAAA,QACL,MAAM,QAAQ,IAAI,WAAW,IAAI,UAAU;AAAA,QAC3C,UAAU,QAAQ,IAAI,WAAW;AAAA,QACjC,WAAW,QAAQ,IAAI,kBAAkB;AAAA,MAC3C;AAAA,IACF,CAAC;AAAA,EACH;AAAA,EAEA,OAAc,qBACZ,SACA,cACA;AACA,WAAO,IAAI,6BAAgB,SAAS,YAAY;AAAA,EAClD;AAAA,EAEA,OAAc,kBACZ,UAA+B,CAAC,GACT;AACvB,YAAQ,QAAQ,MAAM;AAAA,MACpB,KAAK;AACH,eAAO,IAAI,+BAAkB,OAAO,QAAQ,QAAQ,GAAG;AAAA,UACrD,gBAAgB,QAAQ;AAAA,QAC1B,CAAC;AAAA,MACH,KAAK;AACH,eAAO,IAAI,+CAAuB;AAAA,UAChC,MAAM,QAAQ,QAAQ;AAAA,UACtB,WAAW,QAAQ;AAAA,QACrB,CAAC;AAAA,MACH;AACE,eAAO,IAAI,+BAAkB;AAAA,IACjC;AAAA,EACF;AACF;",
  "names": []
}
