{
  "version": 3,
  "sources": ["../../../../../../../../libs/connector-runner-api-source/src/lib/jsession-manager/jsession-manager.ts"],
  "sourcesContent": ["import axios from 'axios';\nimport qs from 'qs';\nimport { Logger } from '@transai/logger';\n\nexport class JsessionManager {\n  #sessionCooky: string | undefined;\n\n  #sessionExpiresAt: number | undefined;\n\n  #logger: Logger;\n\n  constructor(\n    private authUrl: string,\n    private username: string,\n    private password: string,\n  ) {\n    this.#logger = Logger.getInstance();\n\n    this.getSessionCooky()\n      .then((cooky) => {\n        if (cooky) {\n          this.#logger.debug(`Access token retrieved successfully`);\n        } else {\n          this.#logger.error(`Failed to retrieve access token`);\n        }\n      })\n      .catch((error) => {\n        this.#logger.error(`Error retrieving access token: ${error}`);\n      });\n  }\n\n  async getSessionCooky(): Promise<string | undefined> {\n    this.#logger.debug('Getting session cooky');\n    const now = Date.now();\n    if (\n      this.#sessionCooky &&\n      this.#sessionExpiresAt &&\n      now < this.#sessionExpiresAt\n    ) {\n      return this.#sessionCooky;\n    }\n\n    try {\n      this.#logger.debug(this.authUrl, this.username, this.password);\n      const response = await axios.post(\n        this.authUrl,\n        qs.stringify({\n          j_username: this.username,\n          j_password: this.password,\n        }),\n        {\n          headers: {\n            'Content-Type': 'application/x-www-form-urlencoded',\n          },\n          withCredentials: true,\n        },\n      );\n\n      this.#sessionCooky = response.headers['set-cookie']\n        ? response.headers['set-cookie'][0]\n        : undefined;\n      this.#sessionExpiresAt = now + 1800 * 1000 - 10000;\n\n      return this.#sessionCooky;\n    } catch (err) {\n      this.#logger.error(`Failed to retrieve access token: ${err}`);\n      return undefined;\n    }\n  }\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBAAkB;AAClB,gBAAe;AACf,oBAAuB;AAEhB,MAAM,gBAAgB;AAAA,EAO3B,YACU,SACA,UACA,UACR;AAHQ;AACA;AACA;AAER,SAAK,UAAU,qBAAO,YAAY;AAElC,SAAK,gBAAgB,EAClB,KAAK,CAAC,UAAU;AACf,UAAI,OAAO;AACT,aAAK,QAAQ,MAAM,qCAAqC;AAAA,MAC1D,OAAO;AACL,aAAK,QAAQ,MAAM,iCAAiC;AAAA,MACtD;AAAA,IACF,CAAC,EACA,MAAM,CAAC,UAAU;AAChB,WAAK,QAAQ,MAAM,kCAAkC,KAAK,EAAE;AAAA,IAC9D,CAAC;AAAA,EACL;AAAA,EAxBA;AAAA,EAEA;AAAA,EAEA;AAAA,EAsBA,MAAM,kBAA+C;AACnD,SAAK,QAAQ,MAAM,uBAAuB;AAC1C,UAAM,MAAM,KAAK,IAAI;AACrB,QACE,KAAK,iBACL,KAAK,qBACL,MAAM,KAAK,mBACX;AACA,aAAO,KAAK;AAAA,IACd;AAEA,QAAI;AACF,WAAK,QAAQ,MAAM,KAAK,SAAS,KAAK,UAAU,KAAK,QAAQ;AAC7D,YAAM,WAAW,MAAM,aAAAA,QAAM;AAAA,QAC3B,KAAK;AAAA,QACL,UAAAC,QAAG,UAAU;AAAA,UACX,YAAY,KAAK;AAAA,UACjB,YAAY,KAAK;AAAA,QACnB,CAAC;AAAA,QACD;AAAA,UACE,SAAS;AAAA,YACP,gBAAgB;AAAA,UAClB;AAAA,UACA,iBAAiB;AAAA,QACnB;AAAA,MACF;AAEA,WAAK,gBAAgB,SAAS,QAAQ,YAAY,IAC9C,SAAS,QAAQ,YAAY,EAAE,CAAC,IAChC;AACJ,WAAK,oBAAoB,MAAM,OAAO,MAAO;AAE7C,aAAO,KAAK;AAAA,IACd,SAAS,KAAK;AACZ,WAAK,QAAQ,MAAM,oCAAoC,GAAG,EAAE;AAC5D,aAAO;AAAA,IACT;AAAA,EACF;AACF;",
  "names": ["axios", "qs"]
}
