{
  "version": 3,
  "sources": ["../../../../../../../libs/connector-runner-api-source/src/lib/helper.functions.ts"],
  "sourcesContent": ["import {ApiConfig, ApiSourceConfig} from \"./types\";\nimport { OffsetStore } from '@transai/connector-runtime';\nimport * as http2 from 'node:http2';\nimport * as https from 'node:https';\nimport * as http from 'node:http';\n\nexport function generateCollectionName(connectorConfig: ApiSourceConfig, sinkConfig: ApiConfig): string {\n  return `${connectorConfig.datasourceIdentifier}_${sinkConfig.name}`;\n}\n\nexport function generateKafkaTopic(connectorConfig: ApiSourceConfig): string {\n  return `${connectorConfig.tenantIdentifier}_SOURCE_${connectorConfig.datasourceIdentifier}`;\n}\n\nexport function generateOffsetIdentifier(apiConfig: ApiConfig): string {\n  return `${apiConfig.offsetFilePrefix ?? 'offset'}_${apiConfig.name}`;\n}\n\nexport function makeNodeRequest(\n  urlStr: string,\n  method: string,\n  headers: Record<string, string>,\n  body: string,\n  forceTls12: boolean,\n  forceHttp2 = false,\n): Promise<string> {\n  return new Promise((resolve, reject) => {\n    try {\n      const urlObj = new URL(urlStr);\n      const isHttps = urlObj.protocol === 'https:';\n      const isHttp2 = forceHttp2;\n      const options: Record<string, any> = {\n        method,\n        headers,\n      };\n      if (isHttps) {\n        options['rejectUnauthorized'] = true;\n        if (forceTls12) {\n          options['secureProtocol'] = 'TLSv1_2_method';\n        }\n      }\n      if (isHttp2) {\n        // HTTP/2 request\n        const client = http2.connect(urlObj.origin);\n        const req = client.request({\n          ':path': urlObj.pathname + urlObj.search,\n          ':method': method,\n          ...headers,\n        });\n        let data = '';\n        req.setEncoding('utf8');\n        req.on('data', (chunk) => {\n          data += chunk;\n        });\n        req.on('end', () => {\n          client.close();\n          resolve(data);\n        });\n        req.on('error', (err) => {\n          client.close();\n          reject(err);\n        });\n        if (method === 'POST' && body) {\n          req.write(body);\n        }\n        req.end();\n      } else {\n        // HTTP/1.1 or HTTPS request\n        const lib = isHttps ? https : http;\n        const req = lib.request(urlObj, options, (res) => {\n          let data = '';\n          res.setEncoding('utf8');\n          res.on('data', (chunk) => {\n            data += chunk;\n          });\n          res.on('end', () => {\n            resolve(data);\n          });\n        });\n        req.on('error', (err) => {\n          reject(err);\n        });\n        if (method === 'POST' && body) {\n          req.write(body);\n        }\n        req.end();\n      }\n    } catch (err) {\n      reject(err);\n    }\n  });\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA,YAAuB;AACvB,YAAuB;AACvB,WAAsB;AAEf,SAAS,uBAAuB,iBAAkC,YAA+B;AACtG,SAAO,GAAG,gBAAgB,oBAAoB,IAAI,WAAW,IAAI;AACnE;AAEO,SAAS,mBAAmB,iBAA0C;AAC3E,SAAO,GAAG,gBAAgB,gBAAgB,WAAW,gBAAgB,oBAAoB;AAC3F;AAEO,SAAS,yBAAyB,WAA8B;AACrE,SAAO,GAAG,UAAU,oBAAoB,QAAQ,IAAI,UAAU,IAAI;AACpE;AAEO,SAAS,gBACd,QACA,QACA,SACA,MACA,YACA,aAAa,OACI;AACjB,SAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACtC,QAAI;AACF,YAAM,SAAS,IAAI,IAAI,MAAM;AAC7B,YAAM,UAAU,OAAO,aAAa;AACpC,YAAM,UAAU;AAChB,YAAM,UAA+B;AAAA,QACnC;AAAA,QACA;AAAA,MACF;AACA,UAAI,SAAS;AACX,gBAAQ,oBAAoB,IAAI;AAChC,YAAI,YAAY;AACd,kBAAQ,gBAAgB,IAAI;AAAA,QAC9B;AAAA,MACF;AACA,UAAI,SAAS;AAEX,cAAM,SAAS,MAAM,QAAQ,OAAO,MAAM;AAC1C,cAAM,MAAM,OAAO,QAAQ;AAAA,UACzB,SAAS,OAAO,WAAW,OAAO;AAAA,UAClC,WAAW;AAAA,UACX,GAAG;AAAA,QACL,CAAC;AACD,YAAI,OAAO;AACX,YAAI,YAAY,MAAM;AACtB,YAAI,GAAG,QAAQ,CAAC,UAAU;AACxB,kBAAQ;AAAA,QACV,CAAC;AACD,YAAI,GAAG,OAAO,MAAM;AAClB,iBAAO,MAAM;AACb,kBAAQ,IAAI;AAAA,QACd,CAAC;AACD,YAAI,GAAG,SAAS,CAAC,QAAQ;AACvB,iBAAO,MAAM;AACb,iBAAO,GAAG;AAAA,QACZ,CAAC;AACD,YAAI,WAAW,UAAU,MAAM;AAC7B,cAAI,MAAM,IAAI;AAAA,QAChB;AACA,YAAI,IAAI;AAAA,MACV,OAAO;AAEL,cAAM,MAAM,UAAU,QAAQ;AAC9B,cAAM,MAAM,IAAI,QAAQ,QAAQ,SAAS,CAAC,QAAQ;AAChD,cAAI,OAAO;AACX,cAAI,YAAY,MAAM;AACtB,cAAI,GAAG,QAAQ,CAAC,UAAU;AACxB,oBAAQ;AAAA,UACV,CAAC;AACD,cAAI,GAAG,OAAO,MAAM;AAClB,oBAAQ,IAAI;AAAA,UACd,CAAC;AAAA,QACH,CAAC;AACD,YAAI,GAAG,SAAS,CAAC,QAAQ;AACvB,iBAAO,GAAG;AAAA,QACZ,CAAC;AACD,YAAI,WAAW,UAAU,MAAM;AAC7B,cAAI,MAAM,IAAI;AAAA,QAChB;AACA,YAAI,IAAI;AAAA,MACV;AAAA,IACF,SAAS,KAAK;AACZ,aAAO,GAAG;AAAA,IACZ;AAAA,EACF,CAAC;AACH;",
  "names": []
}
