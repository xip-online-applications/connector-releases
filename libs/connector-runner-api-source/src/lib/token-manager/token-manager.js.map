{
  "version": 3,
  "sources": ["../../../../../../../../libs/connector-runner-api-source/src/lib/token-manager/token-manager.ts"],
  "sourcesContent": ["import axios from 'axios';\nimport qs from 'qs';\nimport { Logger } from '@transai/logger';\n\nexport class TokenManager {\n  #token: string | undefined;\n\n  #tokenExpiresAt: number | undefined;\n\n  #logger: Logger;\n\n  constructor(\n    private tokenUrl: string,\n    private clientId: string,\n    private clientSecret: string,\n  ) {\n    this.#logger = Logger.getInstance();\n\n    this.getAccessToken()\n      .then((token) => {\n        if (token) {\n          this.#logger.debug(`Access token retrieved successfully`);\n        } else {\n          this.#logger.error(`Failed to retrieve access token`);\n        }\n      })\n      .catch((error) => {\n        this.#logger.error(`Error retrieving access token: ${error}`);\n      });\n  }\n\n  async getAccessToken(): Promise<string | undefined> {\n    const now = Date.now();\n    if (this.#token && this.#tokenExpiresAt && now < this.#tokenExpiresAt) {\n      return this.#token;\n    }\n\n    try {\n      const response = await axios.post(\n        this.tokenUrl,\n        qs.stringify({\n          grant_type: 'client_credentials',\n          client_id: this.clientId,\n          client_secret: this.clientSecret,\n        }),\n        {\n          headers: {\n            'Content-Type': 'application/x-www-form-urlencoded',\n          },\n        },\n      );\n\n      const { access_token: accessToken, expires_in: expiresIn } = response.data;\n      this.#token = accessToken;\n      this.#tokenExpiresAt = now + expiresIn * 1000 - 10000; // 10s buffer\n\n      return this.#token;\n    } catch (err) {\n      this.#logger.error(`Failed to retrieve access token: ${err}`);\n      return undefined;\n    }\n  }\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBAAkB;AAClB,gBAAe;AACf,oBAAuB;AAEhB,MAAM,aAAa;AAAA,EAOxB,YACU,UACA,UACA,cACR;AAHQ;AACA;AACA;AAER,SAAK,UAAU,qBAAO,YAAY;AAElC,SAAK,eAAe,EACjB,KAAK,CAAC,UAAU;AACf,UAAI,OAAO;AACT,aAAK,QAAQ,MAAM,qCAAqC;AAAA,MAC1D,OAAO;AACL,aAAK,QAAQ,MAAM,iCAAiC;AAAA,MACtD;AAAA,IACF,CAAC,EACA,MAAM,CAAC,UAAU;AAChB,WAAK,QAAQ,MAAM,kCAAkC,KAAK,EAAE;AAAA,IAC9D,CAAC;AAAA,EACL;AAAA,EAxBA;AAAA,EAEA;AAAA,EAEA;AAAA,EAsBA,MAAM,iBAA8C;AAClD,UAAM,MAAM,KAAK,IAAI;AACrB,QAAI,KAAK,UAAU,KAAK,mBAAmB,MAAM,KAAK,iBAAiB;AACrE,aAAO,KAAK;AAAA,IACd;AAEA,QAAI;AACF,YAAM,WAAW,MAAM,aAAAA,QAAM;AAAA,QAC3B,KAAK;AAAA,QACL,UAAAC,QAAG,UAAU;AAAA,UACX,YAAY;AAAA,UACZ,WAAW,KAAK;AAAA,UAChB,eAAe,KAAK;AAAA,QACtB,CAAC;AAAA,QACD;AAAA,UACE,SAAS;AAAA,YACP,gBAAgB;AAAA,UAClB;AAAA,QACF;AAAA,MACF;AAEA,YAAM,EAAE,cAAc,aAAa,YAAY,UAAU,IAAI,SAAS;AACtE,WAAK,SAAS;AACd,WAAK,kBAAkB,MAAM,YAAY,MAAO;AAEhD,aAAO,KAAK;AAAA,IACd,SAAS,KAAK;AACZ,WAAK,QAAQ,MAAM,oCAAoC,GAAG,EAAE;AAC5D,aAAO;AAAA,IACT;AAAA,EACF;AACF;",
  "names": ["axios", "qs"]
}
