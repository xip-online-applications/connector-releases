{
  "version": 3,
  "sources": ["../../../../../../apps/connector-orchestrator/src/main.ts"],
  "sourcesContent": ["/* eslint-disable no-console */\nimport { Logger } from '@transai/logger';\nimport { ConnectorApiClient } from '@transai/management-api-client';\nimport { handleError } from '@xip-online-data/handle-error';\nimport {\n  BaseConnectorConfig,\n  ConnectorInterface,\n  ConnectorOrchestratorConfigWithKafkaInterface,\n} from '@xip-online-data/types';\n\nimport { ClusterManager } from './cluster/cluster.manager';\nimport { ConnectorManager } from './connector/connector.manager';\nimport { NodeWrapper } from './util/node-wrapper';\n\nasync function main(): Promise<void> {\n  const node = new NodeWrapper();\n\n  if (process.env.NODE_ENV === 'development' && node.cluster.isPrimary) {\n    // Wait for a short time to prevent the race condition\n    // fix whenever the NX dependencies are fixed\n    console.warn(\n      'CONNECTOR ORCHESTRATOR: Running in development mode, waiting for 5 seconds to prevent race condition',\n    );\n    await new Promise((resolve) => {\n      setTimeout(resolve, 5 * 1000);\n    });\n  }\n\n  if (node.cluster.isPrimary) {\n    Logger.getInstance(\n      `[${node.process.pid}] connector-orchestrator`,\n    ).setDatadogTransport({\n      service: 'cluster-manager',\n      source: 'connector-orchestrator',\n    });\n\n    new ClusterManager(node, new ConnectorApiClient()).start().subscribe();\n  } else {\n    const connectorData = JSON.parse(\n      node.process.env.CONNECTOR as string,\n    ) as ConnectorInterface<BaseConnectorConfig>;\n    const orchestratorConfig = JSON.parse(\n      node.process.env.ORCHESTRATOR_CONFIG as string,\n    ) as ConnectorOrchestratorConfigWithKafkaInterface;\n\n    Logger.getInstance(\n      `[${node.process.pid}] ${connectorData.identifier}`,\n    ).setDatadogTransport({\n      apiKey: orchestratorConfig.datadogApiKey,\n      service: 'connector-manager',\n      source: 'connector-orchestrator',\n      tags: {\n        connector: connectorData.identifier,\n        tenantIdentifier: connectorData.tenantIdentifier,\n      },\n    });\n\n    await new ConnectorManager(node, connectorData).start();\n  }\n}\n\nmain().catch((error) => {\n  handleError('Error while initializing the app', error);\n});\n"],
  "mappings": "AACA,oBAAuB;AACvB,mCAAmC;AACnC,0BAA4B;AAO5B,qBAA+B;AAC/B,uBAAiC;AACjC,0BAA4B;AAE5B,eAAe,OAAsB;AACnC,QAAM,OAAO,IAAI,gCAAY;AAE7B,MAAI,QAAQ,IAAI,aAAa,iBAAiB,KAAK,QAAQ,WAAW;AAGpE,YAAQ;AAAA,MACN;AAAA,IACF;AACA,UAAM,IAAI,QAAQ,CAAC,YAAY;AAC7B,iBAAW,SAAS,IAAI,GAAI;AAAA,IAC9B,CAAC;AAAA,EACH;AAEA,MAAI,KAAK,QAAQ,WAAW;AAC1B,yBAAO;AAAA,MACL,IAAI,KAAK,QAAQ,GAAG;AAAA,IACtB,EAAE,oBAAoB;AAAA,MACpB,SAAS;AAAA,MACT,QAAQ;AAAA,IACV,CAAC;AAED,QAAI,8BAAe,MAAM,IAAI,gDAAmB,CAAC,EAAE,MAAM,EAAE,UAAU;AAAA,EACvE,OAAO;AACL,UAAM,gBAAgB,KAAK;AAAA,MACzB,KAAK,QAAQ,IAAI;AAAA,IACnB;AACA,UAAM,qBAAqB,KAAK;AAAA,MAC9B,KAAK,QAAQ,IAAI;AAAA,IACnB;AAEA,yBAAO;AAAA,MACL,IAAI,KAAK,QAAQ,GAAG,KAAK,cAAc,UAAU;AAAA,IACnD,EAAE,oBAAoB;AAAA,MACpB,QAAQ,mBAAmB;AAAA,MAC3B,SAAS;AAAA,MACT,QAAQ;AAAA,MACR,MAAM;AAAA,QACJ,WAAW,cAAc;AAAA,QACzB,kBAAkB,cAAc;AAAA,MAClC;AAAA,IACF,CAAC;AAED,UAAM,IAAI,kCAAiB,MAAM,aAAa,EAAE,MAAM;AAAA,EACxD;AACF;AAEA,KAAK,EAAE,MAAM,CAAC,UAAU;AACtB,uCAAY,oCAAoC,KAAK;AACvD,CAAC;",
  "names": []
}
