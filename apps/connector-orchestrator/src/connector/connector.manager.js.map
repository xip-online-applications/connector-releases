{
  "version": 3,
  "sources": ["../../../../../../../apps/connector-orchestrator/src/connector/connector.manager.ts"],
  "sourcesContent": ["import { ConnectorInterface } from '@xip-online-data/types';\nimport { Logger } from '@transai/logger';\nimport { getLogLevel } from '../util/log-level';\nimport { getConnectorType } from './connector-type';\nimport { NodeWrapperInterface } from '../util/node-wrapper';\n\nexport class ConnectorManager {\n  readonly #node: NodeWrapperInterface;\n\n  readonly #connectorData: ConnectorInterface;\n\n  readonly #logger: Logger;\n\n  constructor(node: NodeWrapperInterface) {\n    this.#node = node;\n\n    this.#connectorData = JSON.parse(\n      this.#node.process.env.CONNECTOR as string,\n    ) as ConnectorInterface;\n\n    this.#logger = Logger.getInstance(\n      `${this.#connectorData.identifier} - ${this.#node.process.pid}`,\n      getLogLevel(this.#node),\n    );\n  }\n\n  readonly start = async () => {\n    this.#logger.info(\n      `Worker ${this.#connectorData.connectorType}, ${this.#connectorData.identifier} ${this.#node.process.pid} started`,\n    );\n\n    const connector = getConnectorType(this.#connectorData);\n\n    this.#node.process.on('SIGINT', async () => {\n      this.#logger.warn(\n        `Worker ${this.#connectorData.connectorType}, ${this.#connectorData.identifier} ${this.#node.process.pid} received SIGINT signal. Start graceful shutdown`,\n      );\n      await connector.stop();\n      this.#logger.warn(\n        `Worker ${this.#connectorData.connectorType}, ${this.#connectorData.identifier} ${this.#node.process.pid} received SIGINT signal and finished graceful shutdown`,\n      );\n      this.#node.process.exit(0);\n    });\n\n    this.#node.process.on('SIGTERM', async () => {\n      this.#logger.warn(\n        `Worker ${this.#connectorData.connectorType}, ${this.#connectorData.identifier} ${this.#node.process.pid} received SIGTERM. Start graceful shutdown`,\n      );\n      await connector.stop();\n      this.#logger.warn(\n        `Worker ${this.#connectorData.connectorType}, ${this.#connectorData.identifier} ${this.#node.process.pid} received SIGTERM and finished graceful shutdown`,\n      );\n      this.#node.process.exit(0);\n    });\n\n    this.#node.process.on('uncaughtException', async (error: Error) => {\n      this.#logger.warn(\n        `Worker ${this.#connectorData.connectorType}, ${this.#connectorData.identifier} ${this.#node.process.pid} received uncaughtException signal. Start graceful shutdown`,\n      );\n      this.#logger.error(error);\n      await connector.stop();\n      this.#logger.warn(\n        `Worker ${this.#connectorData.connectorType}, ${this.#connectorData.identifier} ${this.#node.process.pid} received uncaughtException and finished graceful shutdown`,\n      );\n      this.#node.process.exit(1);\n    });\n\n    await connector.start();\n  };\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AACA,oBAAuB;AACvB,uBAA4B;AAC5B,4BAAiC;AAG1B,MAAM,iBAAiB;AAAA,EAO5B,YAAY,MAA4B;AAaxC,SAAS,QAAQ,YAAY;AAC3B,WAAK,QAAQ;AAAA,QACX,UAAU,KAAK,eAAe,aAAa,KAAK,KAAK,eAAe,UAAU,IAAI,KAAK,MAAM,QAAQ,GAAG;AAAA,MAC1G;AAEA,YAAM,gBAAY,wCAAiB,KAAK,cAAc;AAEtD,WAAK,MAAM,QAAQ,GAAG,UAAU,YAAY;AAC1C,aAAK,QAAQ;AAAA,UACX,UAAU,KAAK,eAAe,aAAa,KAAK,KAAK,eAAe,UAAU,IAAI,KAAK,MAAM,QAAQ,GAAG;AAAA,QAC1G;AACA,cAAM,UAAU,KAAK;AACrB,aAAK,QAAQ;AAAA,UACX,UAAU,KAAK,eAAe,aAAa,KAAK,KAAK,eAAe,UAAU,IAAI,KAAK,MAAM,QAAQ,GAAG;AAAA,QAC1G;AACA,aAAK,MAAM,QAAQ,KAAK,CAAC;AAAA,MAC3B,CAAC;AAED,WAAK,MAAM,QAAQ,GAAG,WAAW,YAAY;AAC3C,aAAK,QAAQ;AAAA,UACX,UAAU,KAAK,eAAe,aAAa,KAAK,KAAK,eAAe,UAAU,IAAI,KAAK,MAAM,QAAQ,GAAG;AAAA,QAC1G;AACA,cAAM,UAAU,KAAK;AACrB,aAAK,QAAQ;AAAA,UACX,UAAU,KAAK,eAAe,aAAa,KAAK,KAAK,eAAe,UAAU,IAAI,KAAK,MAAM,QAAQ,GAAG;AAAA,QAC1G;AACA,aAAK,MAAM,QAAQ,KAAK,CAAC;AAAA,MAC3B,CAAC;AAED,WAAK,MAAM,QAAQ,GAAG,qBAAqB,OAAO,UAAiB;AACjE,aAAK,QAAQ;AAAA,UACX,UAAU,KAAK,eAAe,aAAa,KAAK,KAAK,eAAe,UAAU,IAAI,KAAK,MAAM,QAAQ,GAAG;AAAA,QAC1G;AACA,aAAK,QAAQ,MAAM,KAAK;AACxB,cAAM,UAAU,KAAK;AACrB,aAAK,QAAQ;AAAA,UACX,UAAU,KAAK,eAAe,aAAa,KAAK,KAAK,eAAe,UAAU,IAAI,KAAK,MAAM,QAAQ,GAAG;AAAA,QAC1G;AACA,aAAK,MAAM,QAAQ,KAAK,CAAC;AAAA,MAC3B,CAAC;AAED,YAAM,UAAU,MAAM;AAAA,IACxB;AAtDE,SAAK,QAAQ;AAEb,SAAK,iBAAiB,KAAK;AAAA,MACzB,KAAK,MAAM,QAAQ,IAAI;AAAA,IACzB;AAEA,SAAK,UAAU,qBAAO;AAAA,MACpB,GAAG,KAAK,eAAe,UAAU,MAAM,KAAK,MAAM,QAAQ,GAAG;AAAA,UAC7D,8BAAY,KAAK,KAAK;AAAA,IACxB;AAAA,EACF;AAAA,EAjBS;AAAA,EAEA;AAAA,EAEA;AA0DX;",
  "names": []
}
