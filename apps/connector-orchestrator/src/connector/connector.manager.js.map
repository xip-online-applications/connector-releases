{
  "version": 3,
  "sources": ["../../../../../../../apps/connector-orchestrator/src/connector/connector.manager.ts"],
  "sourcesContent": ["import { ConnectorRuntimeSDK } from '@transai/connector-runtime-sdk';\nimport { TransAIConnectorSDK } from '@transai/connector-sdk';\nimport { Logger } from '@transai/logger';\nimport {\n  BaseConnectorConfig,\n  ConnectorInterface,\n} from '@xip-online-data/types';\n\nimport { NodeWrapperInterface } from '../util/node-wrapper';\n\nimport { getConnectorType } from './connector-type';\n\nexport class ConnectorManager {\n  readonly #node: NodeWrapperInterface;\n\n  readonly #connectorData: ConnectorInterface<BaseConnectorConfig>;\n\n  readonly #connectorSDK: TransAIConnectorSDK;\n\n  readonly #logger: Logger;\n\n  constructor(\n    node: NodeWrapperInterface,\n    connectorData: ConnectorInterface<BaseConnectorConfig>,\n  ) {\n    this.#node = node;\n    this.#connectorData = connectorData;\n    this.#logger = Logger.getInstance();\n\n    this.#connectorSDK = new TransAIConnectorSDK(\n      this.#connectorData,\n      this.#logger,\n    );\n  }\n\n  readonly start = async (): Promise<void> => {\n    this.#logger.info(\n      `Worker ${this.#connectorData.connectorType}, ${this.#connectorData.identifier} ${this.#node.process.pid} started`,\n    );\n\n    const connector = getConnectorType(this.#connectorData, this.#connectorSDK);\n\n    this.#node.process.on('SIGINT', async () => {\n      this.#logger.warn(\n        `Worker ${this.#connectorData.connectorType}, ${this.#connectorData.identifier} ${this.#node.process.pid} received SIGINT signal. Start graceful shutdown`,\n      );\n      await connector.stop();\n      await this.#connectorSDK.stop();\n      this.#logger.warn(\n        `Worker ${this.#connectorData.connectorType}, ${this.#connectorData.identifier} ${this.#node.process.pid} received SIGINT signal and finished graceful shutdown`,\n      );\n      this.#node.process.exit(0);\n    });\n\n    this.#node.process.on('SIGTERM', async () => {\n      this.#logger.warn(\n        `Worker ${this.#connectorData.connectorType}, ${this.#connectorData.identifier} ${this.#node.process.pid} received SIGTERM. Start graceful shutdown`,\n      );\n      await connector.stop();\n      await this.#connectorSDK.stop();\n      this.#logger.warn(\n        `Worker ${this.#connectorData.connectorType}, ${this.#connectorData.identifier} ${this.#node.process.pid} received SIGTERM and finished graceful shutdown`,\n      );\n      this.#node.process.exit(0);\n    });\n\n    this.#node.process.on('uncaughtException', async (error: Error) => {\n      this.#logger.warn(\n        `Worker ${this.#connectorData.connectorType}, ${this.#connectorData.identifier} ${this.#node.process.pid} received uncaughtException signal. Start graceful shutdown`,\n      );\n      this.#logger.error(error);\n      await connector.stop();\n      await this.#connectorSDK.stop();\n      this.#logger.warn(\n        `Worker ${this.#connectorData.connectorType}, ${this.#connectorData.identifier} ${this.#node.process.pid} received uncaughtException and finished graceful shutdown`,\n      );\n      this.#node.process.exit(1);\n    });\n\n    if (connector instanceof ConnectorRuntimeSDK) {\n      await connector.init();\n    }\n\n    await connector.start();\n  };\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mCAAoC;AACpC,2BAAoC;AACpC,oBAAuB;AAQvB,4BAAiC;AAE1B,MAAM,iBAAiB;AAAA,EAS5B,YACE,MACA,eACA;AAWF,SAAS,QAAQ,YAA2B;AAC1C,WAAK,QAAQ;AAAA,QACX,UAAU,KAAK,eAAe,aAAa,KAAK,KAAK,eAAe,UAAU,IAAI,KAAK,MAAM,QAAQ,GAAG;AAAA,MAC1G;AAEA,YAAM,gBAAY,wCAAiB,KAAK,gBAAgB,KAAK,aAAa;AAE1E,WAAK,MAAM,QAAQ,GAAG,UAAU,YAAY;AAC1C,aAAK,QAAQ;AAAA,UACX,UAAU,KAAK,eAAe,aAAa,KAAK,KAAK,eAAe,UAAU,IAAI,KAAK,MAAM,QAAQ,GAAG;AAAA,QAC1G;AACA,cAAM,UAAU,KAAK;AACrB,cAAM,KAAK,cAAc,KAAK;AAC9B,aAAK,QAAQ;AAAA,UACX,UAAU,KAAK,eAAe,aAAa,KAAK,KAAK,eAAe,UAAU,IAAI,KAAK,MAAM,QAAQ,GAAG;AAAA,QAC1G;AACA,aAAK,MAAM,QAAQ,KAAK,CAAC;AAAA,MAC3B,CAAC;AAED,WAAK,MAAM,QAAQ,GAAG,WAAW,YAAY;AAC3C,aAAK,QAAQ;AAAA,UACX,UAAU,KAAK,eAAe,aAAa,KAAK,KAAK,eAAe,UAAU,IAAI,KAAK,MAAM,QAAQ,GAAG;AAAA,QAC1G;AACA,cAAM,UAAU,KAAK;AACrB,cAAM,KAAK,cAAc,KAAK;AAC9B,aAAK,QAAQ;AAAA,UACX,UAAU,KAAK,eAAe,aAAa,KAAK,KAAK,eAAe,UAAU,IAAI,KAAK,MAAM,QAAQ,GAAG;AAAA,QAC1G;AACA,aAAK,MAAM,QAAQ,KAAK,CAAC;AAAA,MAC3B,CAAC;AAED,WAAK,MAAM,QAAQ,GAAG,qBAAqB,OAAO,UAAiB;AACjE,aAAK,QAAQ;AAAA,UACX,UAAU,KAAK,eAAe,aAAa,KAAK,KAAK,eAAe,UAAU,IAAI,KAAK,MAAM,QAAQ,GAAG;AAAA,QAC1G;AACA,aAAK,QAAQ,MAAM,KAAK;AACxB,cAAM,UAAU,KAAK;AACrB,cAAM,KAAK,cAAc,KAAK;AAC9B,aAAK,QAAQ;AAAA,UACX,UAAU,KAAK,eAAe,aAAa,KAAK,KAAK,eAAe,UAAU,IAAI,KAAK,MAAM,QAAQ,GAAG;AAAA,QAC1G;AACA,aAAK,MAAM,QAAQ,KAAK,CAAC;AAAA,MAC3B,CAAC;AAED,UAAI,qBAAqB,kDAAqB;AAC5C,cAAM,UAAU,KAAK;AAAA,MACvB;AAEA,YAAM,UAAU,MAAM;AAAA,IACxB;AA3DE,SAAK,QAAQ;AACb,SAAK,iBAAiB;AACtB,SAAK,UAAU,qBAAO,YAAY;AAElC,SAAK,gBAAgB,IAAI;AAAA,MACvB,KAAK;AAAA,MACL,KAAK;AAAA,IACP;AAAA,EACF;AAAA,EApBS;AAAA,EAEA;AAAA,EAEA;AAAA,EAEA;AAkEX;",
  "names": []
}
